+function(){var s={aGuessList:[],oGuessHash:{},oRich:null,_ui:{},oBetHash:{},aGuessDefault:[],tmpl:{guessList:'<div class="guess-area" data-qid="${guessId}">                    <div class="guess-hd">${guessTitle}</div>                    <div class="guess-bd clearfix">                      <div class="left-area">                        <div class="guess-row bet-disabled clearfix answer" data-aid="1">                          <div class="guess-left">${answer1}:</div>                          <div class="guess-right">                            <div class="bet-chose clearfix">                              <div class="bar-area">                                <i class="bar answer-rate" style="width:0;"></i>                              </div>                              <div class="guess-score answer-odds" data-banker="0" data-odds="0">1:0</div>                              <a href="javascript:;" class="bet-btn js-bet-btn">投注</a>                            </div>                          </div>                        </div>                        <div class="guess-row bet-disabled clearfix answer" data-aid="2">                          <div class="guess-left">${answer2}:</div>                          <div class="guess-right">                            <div class="bet-chose clearfix">                              <div class="bar-area">                                <i class="bar answer-rate" style="width:0;"></i>                              </div>                              <div class="guess-score answer-odds" data-banker="0" data-odds="0">1:0</div>                              <a href="javascript:;" class="bet-btn js-bet-btn">投注</a>                            </div>                          </div>                        </div>                      </div>                      <div class="right-area">                        <a href="javascript:;" class="makers-btn js-banker-btn">坐庄</a>                      </div>                    </div>                  </div>',guessItemBuildDisabled:'<div class="open-guess-area" data-index="${index}">                                <div class="open-guess-row clearfix">                                  <div class="left">${title}：</div>                                  <div class="right">                                    <input type="text" class="big-input" disabled value="${guessTitle}" />                                  </div>                                </div>                                <div class="open-guess-row clearfix">                                  <div class="left">竞猜选项：</div>                                  <div class="right">                                    <input type="text" class="small-input" disabled value="${answer1}" />                                    <span class="vs">vs</span>                                    <input type="text" class="small-input" disabled value="${answer2}" />                                  </div>                                </div>                              </div>',guessItemBuild:'<div class="open-guess-area guess-item-build" data-index="${index}">                        <div class="open-guess-row clearfix">                          <div class="left">${title}：</div>                          <div class="right">                            <div class="di pr guess-build-control">                              <label class="guess-build-label">不能超过10个字</label>                              <input type="text" class="big-input guessTitle-input guess-build-input" />                            </div>                          </div>                        </div>                        <div class="open-guess-row clearfix">                          <div class="left">竞猜选项：</div>                          <div class="right">                            <div class="di pr guess-build-control">                              <label class="guess-build-label">不能超过5个字</label>                              <input type="text" class="small-input answer1-input guess-build-input" />                            </div>                            <span class="vs">vs</span>                            <div class="di pr guess-build-control">                              <label class="guess-build-label">不能超过5个字</label>                              <input type="text" class="small-input answer2-input guess-build-input" />                            </div>                          </div>                        </div>                      </div>',guessItemBuildDefault:'<div class="open-guess-area guess-item-build" data-index="${index}">                        <div class="open-guess-row clearfix">                          <div class="left">${title}：</div>                          <div class="right">                            <div class="di pr guess-build-control">                              <label class="guess-build-label" style="display:none;">不能超过10个字</label>                              <input type="text" class="big-input guessTitle-input guess-build-input" value="${guessTitle}" />                            </div>                          </div>                        </div>                        <div class="open-guess-row clearfix">                          <div class="left">竞猜选项：</div>                          <div class="right">                            <div class="di pr guess-build-control">                              <label class="guess-build-label" style="display:none;">不能超过5个字</label>                              <input type="text" class="small-input answer1-input guess-build-input" value="${a1}" />                            </div>                            <span class="vs">vs</span>                            <div class="di pr guess-build-control">                              <label class="guess-build-label" style="display:none;">不能超过5个字</label>                              <input type="text" class="small-input answer2-input guess-build-input" value="${a2}" />                            </div>                          </div>                        </div>                      </div>',guessItemClose:'<div class="close-guess-area guess-item-close" data-qid="${guessId}">                        <p class="title-info">${guessTitle}</p>                        <div class="close-guess-row">                          <label class="dv">                            <input type="radio" value="1" name="quesion_${guessId}" class="dv">                            <span class="dv">${answer1}</span>                          </label>                          <label class="dv">                            <input type="radio" value="2" name="quesion_${guessId}" class="dv">                            <span class="dv">${answer2}</span>                          </label>                          <label class="dv">                            <input type="radio" value="0" name="quesion_${guessId}" class="dv">                            <span class="dv">流局</span>                          </label>                          <label class="dv last">                            <input type="radio" name="quesion_${guessId}" value="3" class="dv">                            <span class="dv">截止投注</span>                          </label>                        </div>                      </div>',setBanker:'<form>                    <div class="makers-info-area">                      <i class="triangle-icon"></i>                      <a href="javascript:;" class="makers-close js-close-banker"></a>                      <div class="makers-hd">竞猜主题：<span class="js-baner-guess-title"></span></div>                      <div class="makers-row clearfix">                        <div class="makers-left">我押：</div>                        <div class="makers-right">                          <label class="dv">                            <input type="radio" name="answer-banker" value="1" class="dv answer-banker">                            <span class="dv js-banker-guess-answer1"></span>                          </label>                          <label class="dv">                            <input type="radio" name="answer-banker" value="2" class="dv answer-banker">                            <span class="dv js-banker-guess-answer2"></span>                          </label>                        </div>                      </div>                      <div class="makers-row clearfix">                        <div class="makers-left">赔率：</div>                        <div class="makers-right">                          <span class="dv">1:</span>                          <div class="di pr">                            <input type="text" class="dv input odds-banker guess-banker-input" placeholder="0.1~9.9">                          </div>                        </div>                      </div>                      <div class="makers-row clearfix">                        <div class="makers-left">金额：</div>                        <div class="makers-right">                          <input type="text" class="dv input coin-banker" />                          <span class="notes dv">不得少于1000战旗币</span>                        </div>                      </div>                      <div class="makers-row clearfix">                        <div class="makers-left">&nbsp;</div>                        <div class="makers-right">                          <span class="winget-banker" style="display:none;"></span>                          <a href="/news/2015/05/23/245.html" target="_blank">详细规则</a>                        </div>                      </div>                      <div class="account-info clearfix">                        <div class="my-account">我的账户：<span class="js-banker-guess-coin"></span>战旗币</div>                        <a href="/user/charge" target="_blank" class="recharge-btn">充值</a>                      </div>                      <input type="hidden" value="" class="guessId-banker js-banker-guess-id" />                      <div class="textC">                        <button type="submit" class="confirm-btn">确定</button>                      </div>                    </div>                  </form>',guessResult:'<div class="guess-results-ibox" data-gid="${guessId}">                      <div class="content">                        <div class="hd">                          竞猜结果                          <a href="javascript:;" title="关闭" class="close js-close"></a>                        </div>                        <div class="bd">                          <p class="title-info">${guessTitle}</p>                          <p class="title-info">竞猜结果：<span class="js-result-txt">${answer}</span></p>                          <p class="title-info js-result-win-loading" style="${loadingDisplay}">收益结算中，请稍等</p>                          <p class="title-info js-result-win-layer" style="${winDisplay}">收益：<span class="num js-result-win-txt">${win}</span></p>                          <div class="textC">                            <a href="javascript:;" class="big-bule-btn di js-close">关闭</a>                          </div>                        </div>                      </div>                    </div>',setBet:'<div class="bet-info-area js-guess-cathectic-panel" id="js-guess-cathectic-panel">                <input type="hidden" class="cathectic-qid" />                <input type="hidden" class="cathectic-aid" />                <input type="hidden" class="cathectic-banker" />                <input type="hidden" class="cathectic-odds" />                <i class="triangle-icon"></i>                <a href="javascript:;" class="bet-close js-close-cathectic"></a>                <div class="bet-account-info">我的账户：<span class="coin-now">0</span>战旗币</div>                <form>                  <div class="bet-charge clearfix">                    <input type="text" class="js-cathectic-coin-input" />                    <a href="javascript:;" class="js-cathectic-all">全押</a>                    <div class="tit">赢则赚<span class="cathectic-winget">0</span></div>                  </div>                  <div class="makers-remain">庄家剩余：<span class="cathectic-rest" data-rest="0">0</span></div>                  <div class="a-area textC">                    <a href="javascript:;" class="ok-btn js-cathectic-send">购买</a>                    <a href="javascript:;" class="no-btn js-cancel">取消</a>                  </div>                </form>              </div>'},init:function(){var s=this;s.view(),s.bindEvent(),s.listenYpEvent(),s.listenSocket(),yp.module.fRegistModule("oGuess",s)},view:function(){var s=this,e=this._ui;$("body").append('<div class="open-guess-ibox" id="js-guess-build-panel" style="display: none;">                          <div class="content">                            <div class="hd">                              开启竞猜                              <a href="javascript:;" title="关闭" class="close js-close"></a>                            </div>                            <div class="bd">                              <form>                                <div class="guess-build-layer"></div>                                <div><span class="dv" style="margin-left:63px;color:red;padding:10px 0;">每次可以只开启一个竞猜</span></div>                                <div class="textC">                                  <button class="big-bule-btn di">确定</button>                                </div>                              </form>                            </div>                          </div>                        </div>').append('<div class="close-guess-ibox" id="js-guess-close-panel" style="display: none;">                      <div class="content">                        <div class="hd">                          结束竞猜                          <a href="javascript:;" title="关闭" class="close js-close"></a>                        </div>                        <div class="bd">                          <form>                            <div class="guess-close-layer"></div>                            <div class="textC">                              <button class="big-bule-btn di">确定</button>                              <p>请谨慎选择，若发现作弊将永久关闭竞猜功能</p>                            </div>                          </form>                        </div>                      </div>                    </div>').append('<div class="common-ibox guess-ibox" id="js-guess-list-panel" style="display:none;">                        <div class="content">                          <div class="hd">                            竞猜                            <a href="javascript:;" class="close js-close"></a>                          </div>                          <div class="bd">                            <a href="https://www.zhanqi.tv/news/2015/05/23/245.html" target="_blank" class="guess-descripte">竞猜说明？</a>                            <div class="js-guess-list"></div>                          </div>                        </div>                      </div>'),$("#js-anchor-control-btn-list").append('<li><a href="javascript:;" id="js-guess-start">开启竞猜</a></li>'),$("#js-anchor-control-btn-list").append('<li><a href="javascript:;" class="gray-state" id="js-guess-end" style="display:none;">结束竞猜</a></li>'),e.$guess_build_panel=$("#js-guess-build-panel"),e.$guess_close_panel=$("#js-guess-close-panel"),e.$guess_list_panel=$("#js-guess-list-panel"),e.$guess_start_btn=$("#js-guess-start"),e.$guess_end_btn=$("#js-guess-end"),e.$js_guess_cathectic_panel=$(s.tmpl.setBet),e.$js_guess_banker_panel=$(s.tmpl.setBanker);var a='<li style="display:none;">                    <a href="javascript:;">                      <img src="'+oPageConfig.oUrl.sUrlBase+'images/index/jc.jpg" alt="">                    </a>                  </li>';e.$guess_list_btn=yp.module.fCallFun("oBaseUI","fRegistRoomFun",[{sHtml:a,key:"guess",weight:20}])},bindEvent:function(){var s=this,e=s._ui;this.fBuildGuess(),this.fBuildGuessPanelEvent(),this.fCloseGuess(),this.fCloseGuessPanelEvent(),e.$guess_list_btn.on("click",function(e){e.preventDefault(),s.fShowGuessListPanel()}),e.$guess_list_panel.on("click",".js-close",function(e){e.preventDefault(),s.fHideGuessListPanel()}),e.$guess_list_panel.on("click",".js-bet-btn",function(e){e.preventDefault(),s.fShowBetPanel($(this))}),e.$guess_list_panel.on("click",".js-banker-btn",function(e){e.preventDefault(),s.fShowBankerPanel($(this))})},listenYpEvent:function(){var s=this;yp.sub("page/room/login/done",function(){s.ajax_socket("Guess.Detail"),oPageConfig.oLoginInfo&&oPageConfig.oLoginInfo.uid==oPageConfig.oRoom.uid&&s.ajax_socket("Guess.Init")}),yp.sub("page/login/anchorNext",function(){s.fCheckGuessBtn()}),yp.sub("page/logout/done",function(){s.oBetHash={}})},listenSocket:function(){var s=this,e=s._ui;$.topic("msgc/Guess.Detail").sub(function(e){s.fDataClean(),0==e.code&&(s.fStoreGuessData(e.data),s.fCheckGuessBtn())}),$.topic("msgc/Guess.Begin").sub(function(e){0!=e.code?e.message&&yp.errorNotify(e.message):s.fShowGuessBeginNotice()}),$.topic("msgc/Guess.BeginCast").sub(function(a){s.fStoreGuessData(a.data),s.fCheckGuessBtn();var t=s.fGuessItemHtml(a.data.id);e.$guess_list_panel.find(".js-guess-list").append(t),s.fDoGetOdds(a.data.id,1),s.fDoGetOdds(a.data.id,2)}),$.topic("msgc/Guess.End").sub(function(s){0!=s.code&&s.message&&yp.errorNotify(s.message)}),$.topic("msgc/Guess.Endinfo").sub(function(e){var a=s.fGuessEnd(e.data.guessId,e.data.result);oPageConfig.oLoginInfo&&oPageConfig.oLoginInfo.uid!=oPageConfig.oRoom.uid&&(s.fShowGuessResult({guessId:e.data.guessId}),a&&a.bJoin&&2==e.data.status&&setTimeout(function(){s.ajax_socket("Guess.Result",{guessId:e.data.guessId})},1e3*Math.round(9*Math.random()+1)))}),$.topic("msgc/Guess.Result").sub(function(e){s.fGuessEnd(e.data.guessId,e.data.result),s.fShowGuessResult(e.data)}),$.topic("msgc/Guess.Bank").sub(function(e){if(0!=e.code)e.message&&yp.errorNotify(e.message),yp.pub("page/rich/update",{num:e.data.coin,type:"coin"});else{var a=s.fGetGuessInfo(e.data.guessId);a.bJoin=1}}),$.topic("msgc/Guess.BankCast").sub(function(e){var a=s.fGetGuessInfo(e.data.guessId),t=a.answers[1==e.data.answer?0:1];t.bankerLen++,t.totalcoin+=+e.data.coin,s.bGuessListShow&&(1==t.bankerLen&&s.fDoGetOdds(e.data.guessId,e.data.answer),s.fUpdateCoinRate(e.data.guessId))}),$.topic("msgc/Guess.Bet").sub(function(a){if(0==a.code){var t=s.fGetGuessInfo(a.data.guessId);if(t.bJoin=1,0<a.data.coin){yp.successNotify("此庄已被全部购买，返还多余的"+a.data.coin+"战旗币");var i=e.$guess_list_panel.find('.guess-area[data-qid="'+a.data.guessId+'"] .answer[data-aid="'+a.data.answer+'"] .answer-odds').data("banker");s.oBetHash[a.data.guessId+"-"+a.data.answer]&&i==s.oBetHash[a.data.guessId+"-"+a.data.answer]&&(clearTimeout(s.oGetOddTime[a.data.guessId+"-"+a.data.answer]),s.fDoGetOdds(a.data.guessId,1==a.data.answer?2:1))}}else a.message&&yp.errorNotify(a.message);a.data.coin&&yp.pub("page/rich/update",{num:a.data.coin,type:"coin"})}),$.topic("msgc/Guess.BetCast").sub(function(e){var a=s.fGetGuessInfo(e.data.guessId),t=a.answers[1==e.data.answer?0:1],i=a.answers[1==e.data.answer?1:0];if(t.totalcoin+=+e.data.coin,void 0!=i.bankersHash[e.data.bankId]){var n,l=i.bankers[i.bankersHash[e.data.bankId]];l.betCoin+=+e.data.coin,s.bGuessListShow&&(n=Math.floor(l.coin-l.rate*l.betCoin),0>=n&&(clearTimeout(s.oGetOddTime[e.data.guessId+"-"+e.data.answer]),s.fDoGetOdds(e.data.guessId,1==e.data.answer?2:1)))}s.bGuessListShow&&s.fUpdateCoinRate(e.data.guessId)}),$.topic("msgc/Guess.BankInfo").sub(function(e){var a=s.fGetGuessInfo(e.data.guessId),t=a.answers[1==e.data.answer?0:1],i=t.bankers,n=t.bankersHash,l=e.data;e.data.coin<=e.data.rate*e.data.betCoin?(i.bankerLen=i.length,l=s.fRandOdds(e.data.guessId,e.data.answer)):void 0==n[e.data.bankId]&&(n[e.data.bankId]=i.length,i.push(e.data)),s.fGetOddsRank(e.data.guessId,e.data.answer),s.bGuessListShow&&s.fSetOdds(e.data)}),$.topic("msgc/Guess.PauseCast").sub(function(e){s.fGuessEndGuess(e.data.guessId)}),$.topic("msgc/Guess.Init").sub(function(e){s.aGuessDefault.push(e.data)})},ajax_socket:function(s,e){return e=e||{},yp.ajax(s,{type:"socket",data:e})},nGuessCnt:0,fStoreGuessData:function(s){var e=this;yp.each(s,function(s){e.oGuessHash[s.id]||(e.oGuessHash[s.id]=e.aGuessList.length,e.aGuessList.push({guessTitle:s.title,guessId:s.id,answers:[{des:s.a1,totalcoin:s.c1||0,bankers:[],bankersHash:{},bankerLen:0|s.t1},{des:s.a2,totalcoin:s.c2||0,bankers:[],bankersHash:{},bankerLen:0|s.t2}],bOver:!1,bJoin:s.j||0,result:-1,stop:+s.p||0}),!e.aGuessList[e.oGuessHash[s.id]].bOver&&e.nGuessCnt++)})},fGuessEndGuess:function(s){var e=this,a=e._ui,t=e.fGetGuessInfo(s);t.stop=1,clearTimeout(e.oGetOddTime[s+"-1"]),clearTimeout(e.oGetOddTime[s+"-2"]),e.fRandOdds(s,1),e.fRandOdds(s,2);var i=a.$guess_list_panel.find('.guess-area[data-qid="'+msg.data.guessId+'"]');i.hasClass("makers-abled")&&(i.removeClass("makers-abled"),a.$js_guess_banker_panel.remove()),i.find(".bet-abled").length&&(i.find(".bet-abled").removeClass("bet-abled"),a.$js_guess_cathectic_panel.remove())},fBuildGuess:function(){var s=this,e=s._ui;e.$guess_start_btn.on("click",function(a){a.preventDefault();var t,i="",n=1,l=1,d=["","竞猜一","竞猜二","竞猜三"];for(yp.each(s.aGuessList,function(e){if(!e.bOver){if(l>3)return!1;t={guessTitle:e.guessTitle,answer1:e.answers[0].des,answer2:e.answers[1].des,title:d[l],index:l},i+=yp.format(s.tmpl.guessItemBuildDisabled,t),l++,n++}});3>=l;l++)s.aGuessDefault[l-n]?(t=s.aGuessDefault[l-n],t.guessTitle=t.title,t.title=d[l],t.index=l,i+=yp.format(s.tmpl.guessItemBuildDefault,t)):(t={title:d[l],index:l},i+=yp.format(s.tmpl.guessItemBuild,t));e.$guess_build_panel.show().find(".guess-build-layer").html(i);var u="input",c=!-[1];c&&(u="propertychange"),e.$guess_build_panel.find(".guess-build-input").on(u,function(){var s=$(this);""==s.val()?s.closest(".guess-build-control").find(".guess-build-label").fadeIn(200):s.closest(".guess-build-control").find(".guess-build-label").fadeOut(200)}).on("blur",function(){var s=$(this);""==s.val()&&s.closest(".guess-build-control").find(".guess-build-label").fadeIn(200)}),e.$guess_build_panel.on("click",".guess-build-label",function(s){s.preventDefault(),$(this).closest(".guess-build-control").find(".guess-build-input").focus()})})},fBuildGuessPanelEvent:function(){var s=this,e=s._ui;e.$guess_build_panel.on("click",".js-close",function(s){s.preventDefault(),e.$guess_build_panel.hide()});var a=e.$guess_build_panel.find("form");a.on("submit",function(e){e.preventDefault(),s.fGuessStart(a)})},fGuessStart:function(s){var e=this,a=e._ui,t=s.find(".guess-item-build");if(0==t.length)return a.$guess_build_panel.hide(),!1;var i=[],n=!1,l=/^[\u4E00-\u9FA5A-Za-z0-9_:\-]+$/;return yp.each(t,function(s){var e=$(s),a=e.find(".guessTitle-input").val(),t=e.find(".answer1-input").val(),d=e.find(".answer2-input").val(),u=e.data("index"),c=["","竞猜一","竞猜二","竞猜三"];if(a&&t&&d){if(10<a.length)return yp.errorNotify(c[u]+"的标题不超过10个字"),n=!0,!1;if(5<t.length)return yp.errorNotify(c[u]+"的选项一不超过5个字"),n=!0,!1;if(5<d.length)return yp.errorNotify(c[u]+"的选项二不超过5个字"),n=!0,!1;if(!l.test(a)||!l.test(t)||!l.test(d))return yp.errorNotify(c[u]+"的标题、选项中仅允许中英文、下划线、冒号，以及短横线"),n=!0,!1;if(t==d)return yp.errorNotify(c[u]+"的两个选项不能相同"),n=!0,!1;i.push({title:a,a1:t,a2:d})}}),n?!1:i.length?(e.ajax_socket("Guess.Begin",{data:i}),void a.$guess_build_panel.hide()):(yp.errorNotify("请完整填写竞猜标题、竞猜选项"),!1)},fShowGuessBeginNotice:function(){var s=$.cookie("guess_begin_notice_cookie");if(!s&&oPageConfig.oLoginInfo&&oPageConfig.oLoginInfo.uid==oPageConfig.oRoom.uid){var e=$("#js-guess-begin-notice");if(!e.length){var a='<div class="open-guess-ibox" id="js-guess-begin-notice" style="display: none;">                        <div class="content" style="width: 350px;">                          <div class="hd">                            开启成功                            <a href="javascript:;" title="关闭" class="close js-close"></a>                          </div>                          <div class="bd">                            <div style="padding: 20px 18px 50px;line-height: 20px;">                              竞猜开启成功，您可以选择在合适的时间在“结束竞猜”选项中截止投注。并在最终结果出来后选择答案结束竞猜。                            </div>                            <div class="textC">                              <label style="text-align: left;padding: 0 50px;line-height: 24px;">                                <input type="checkbox" class="dv js-notice-non">&nbsp;不再提示该消息                              </label>                              <button class="big-bule-btn di js-notice-ok">确定</button>                            </div>                          </div>                        </div>                      </div>';$("body").append(a),e=$("#js-guess-begin-notice"),e.on("click",".js-close",function(s){s.preventDefault(),e.hide()}),e.on("click",".js-notice-ok",function(s){if(s.preventDefault(),e.hide(),e.find(".js-notice-non").prop("checked")){var a=new Date;a.setTime(a.getTime()+31536e6),$.cookie("guess_begin_notice_cookie",1,{expires:a,path:"/"})}})}e.show()}},fCheckGuessBtn:function(){var s=this,e=s._ui;oPageConfig.oLoginInfo&&oPageConfig.oLoginInfo.uid==oPageConfig.oRoom.uid&&(e.$guess_start_btn.toggle(3>s.nGuessCnt),e.$guess_end_btn.toggle(0<s.nGuessCnt)),e.$guess_list_btn.toggle(0<s.nGuessCnt),yp.module.fCallFun("oBaseUI","fCheckFunBtnScrollBtn")},fCloseGuess:function(){var s=this,e=s._ui;e.$guess_end_btn.on("click",function(a){a.preventDefault();var t="",i=1,n=[];return yp.each(s.aGuessList,function(e){if(!e.bOver){if(i>3)return!1;e.stop&&n.push(e.guessId);var a={guessId:e.guessId,guessTitle:e.guessTitle,answer1:e.answers[0].des,answer2:e.answers[1].des};t+=yp.format(s.tmpl.guessItemClose,a),i++}}),""==t?!1:(e.$guess_close_panel.show().find(".guess-close-layer").html(t),e.$guess_close_panel.find(".guess-item-close").first().addClass("first"),void e.$guess_close_panel.find(".guess-item-close").last().addClass("last"))})},fCloseGuessPanelEvent:function(){var s=this,e=s._ui;e.$guess_close_panel.on("click",".js-close",function(s){s.preventDefault(),e.$guess_close_panel.hide()});var a=e.$guess_close_panel.find("form");a.on("submit",function(e){e.preventDefault(),s.fGuessStop(a)})},fGuessStop:function(s){var e=this,a=s.find(".guess-item-close"),t=[],i=[];if(yp.each(a,function(s){var e=$(s).find(":radio");yp.each(e,function(e){return e.checked&&""!=e.value?(3==+e.value?i.push({guessId:$(s).data("qid")}):t.push({guessId:$(s).data("qid"),result:+e.value}),!1):void 0})}),t.length||i.length){var n="js-guess-end-confirm-"+$.now(),l='<div class="close-guess-ibox" id="'+n+'">                      <div class="content">                        <div class="hd">                          结束竞猜                          <a href="javascript:;" title="关闭" class="close js-close"></a>                        </div>                        <div class="bd">                          <div class="textC" style="padding: 15px 0;">                            <p style="font-size: 14px;color: #333;">确定执行上述操作？</p>                          </div>                          <div class="textC" style="padding-bottom: 25px;">                            <a href="javascript:;" class="blue-zs-btn di js-confirm" style="margin: 0 10px;width: 100px;height: 30px;line-height: 30px;font-size: 14px;border-radius: 5px;text-align: center;">确定</a>                            <a href="javascript:;" class="gray-qx-btn di js-close" style="margin: 0 10px;width: 100px;height: 30px;line-height: 30px;font-size: 14px;border-radius: 5px;text-align: center;">取消</a>                          </div>                        </div>                      </div>                    </div>';$("body").append(l);var d=$("#"+n);d.on("click",".js-close",function(s){s.preventDefault(),d.remove()}),d.on("click",".js-confirm",function(s){s.preventDefault(),d.remove(),e._ui.$guess_close_panel.hide(),t.length&&yp.each(t,function(s){e.ajax_socket("Guess.End",s)}),i.length&&yp.each(i,function(s){e.ajax_socket("Guess.Stop",s)})})}},fDataClean:function(){this.aGuessList=[],this.oGuessHash={},this.nGuessCnt=0},fShowGuessResult:function(s){var e=this,a=$('.guess-results-ibox[data-gid="'+s.guessId+'"]'),t=e.aGuessList[e.oGuessHash[s.guessId]];if(!t||!t.bJoin)return!1;if(a.length)void 0!=s.amount&&(a.find(".js-result-win-layer").show(),a.find(".js-result-win-loading").hide(),a.find(".js-result-win-layer").find(".js-result-win-txt").html(0<s.amount?"+"+s.amount:s.amount));else{var i="",n="";i=1==t.result?t.answers[0].des:2==t.result?t.answers[1].des:"流局",void 0!=s.amount&&(n=0<s.amount?"+"+s.amount:""+s.amount);var l={guessId:t.guessId,guessTitle:t.guessTitle,answer:i,loadingDisplay:void 0==s.amount?"":"display:none;",winDisplay:void 0==s.amount?"display:none;":"",win:n},d=yp.format(e.tmpl.guessResult,l);a=$(d),$("body").append(a),a.on("click",".js-close",function(s){s.preventDefault(),a.remove()})}void 0!=s.amount&&yp.pub("page/rich/update",{num:s.coin,type:"coin"})},fGetGuessInfo:function(s){return void 0!=this.oGuessHash[s]?this.aGuessList[+this.oGuessHash[s]]:!1},fFormatCoin:function(s){return!s||isNaN(s)?s="":s>1e4&&(s=Math.floor(s/1e4)+"万+"),s},fCalculateWin:function(s,e){return Math.floor(s*e)-Math.ceil(.05*(s+s*e))},bGuessListShow:!1,fShowGuessListPanel:function(){var s=this,e=s._ui;if(0==s.nGuessCnt)return!1;e.$guess_list_panel.show(),s.bGuessListShow=!0;var a="";yp.each(s.aGuessList,function(e){e.bOver||(a+=s.fGuessItemHtml(e.guessId))}),a&&(e.$guess_list_panel.find(".js-guess-list").html(a),yp.each(e.$guess_list_panel.find(".guess-area"),function(e){var a=$(e).data("qid");s.fDoGetOdds(a,1),s.fDoGetOdds(a,2),s.fUpdateCoinRate(a)}))},fGuessItemHtml:function(s){var e=this,a="",t=e.aGuessList[e.oGuessHash[s]];if(t){var i=e.fCalculateCoinRate(s),n=e.fRandOdds(s,2),l=e.fRandOdds(s,1),d={guessId:t.guessId,guessTitle:t.guessTitle,answer1:t.answers[0].des,answer2:t.answers[1].des,republicansDisable:0==t.stop?"":"***",rate1:i[0],rate2:i[1],banker1:n.guessId,banker2:l.guessId,odds1:n.coin?n.rate:0,odds2:l.coin?l.rate:0};a=yp.format(e.tmpl.guessList,d)}return a},fCalculateCoinRate:function(s){var e=this,a=(e._ui,e.aGuessList[e.oGuessHash[s]]),t=0,i=0;return(0<a.answers[0].totalcoin||0<a.answers[1].totalcoin)&&(t=100*a.answers[0].totalcoin/(a.answers[0].totalcoin+a.answers[1].totalcoin),t=+t.toFixed(2),i=100-t),[t,i]},fUpdateCoinRate:function(s){var e=this,a=e._ui,t=e.fCalculateCoinRate(s),i=a.$guess_list_panel.find('.guess-area[data-qid="'+s+'"]');i.length&&(i.find('.answer[data-aid="1"] .answer-rate').css({width:t[0]+"%"}),i.find('.answer[data-aid="2"] .answer-rate').css({width:t[1]+"%"}))},fRandOdds:function(s,e){var a,t=this,i=t.fGetUsableBanker(s,e);return a=0==i.length?{guessId:s,answer:e}:i[Math.floor(Math.random()*i.length)]},fSetOdds:function(s){var e=this,a=e._ui,t=a.$guess_list_panel.find('.guess-area[data-qid="'+s.guessId+'"] .answer[data-aid="'+(1==s.answer?2:1)+'"]');return t.hasClass("bet-abled")?!1:void(s.coin?(t.find(".answer-odds").data("banker",s.bankId).data("odds",s.rate).html("1:"+s.rate),t.removeClass("bet-disabled")):(t.find(".answer-odds").data("banker",0).data("odds",0).html("1:0"),t.addClass("bet-disabled")))},fGetUsableBanker:function(s,e){var a=this,t=a.fGetGuessInfo(s),i=[],n=t.answers[1==e?0:1];return t.stop||yp.each(n.bankers,function(s){s.coin>s.rate*s.betCoin&&i.push(s)}),i},fHideGuessListPanel:function(){var s=this,e=s._ui;e.$guess_list_panel.hide(),s.bGuessListShow=!1},oGetOddTime:{},fGetOddsRank:function(s,e){var a=this;a.oGetOddTime[s+"-"+e]=setTimeout(function(){a.fDoGetOdds(s,e)},1e4)},fDoGetOdds:function(s,e){var a,t,i=this,n=(i._ui,i.fGetGuessInfo(s));return!n||n.bOver||n.stop||!i.bGuessListShow?!1:(a=n.answers[1==e?0:1],t=a.bankers,a.bankerLen?void(t.length!=a.bankerLen?i.ajax_socket("Guess.BankInfo",{guessId:s,answer:e}):(oBanker=i.fRandOdds(s,e),i.fSetOdds(oBanker))):!1)},fShowBetPanel:function(s){var e=this,a=e._ui,t=s.closest(".guess-row"),i=s.closest(".guess-area");return t.hasClass("bet-disabled")||t.hasClass("bet-abled")?!1:(i.hasClass("makers-abled")&&(i.removeClass("makers-abled"),a.$js_guess_banker_panel.remove()),a.$guess_list_panel.find(".bet-abled").removeClass("bet-abled"),
t.addClass("bet-abled").find(".guess-right").append(a.$js_guess_cathectic_panel),e.fCathecticData(i,t),void e.fCathecticPopPanelEvent())},fCathecticData:function(s,e){var a=this,t=a._ui,i=s.data("qid"),n=e.data("aid"),l=e.find(".answer-odds"),d=l.data("banker"),u=l.data("odds"),c=a.aGuessList[a.oGuessHash[i]],o=a.fGetBankRestCoin(i,1==n?2:1,d);return c.stop?(alert("该竞猜已停止投注"),!1):(t.$js_guess_cathectic_panel.find(".coin-now").html(a.oRich.fReturnRich("coin")),t.$js_guess_cathectic_panel.find(".cathectic-qid").val(i),t.$js_guess_cathectic_panel.find(".cathectic-aid").val(n),t.$js_guess_cathectic_panel.find(".cathectic-banker").val(d),t.$js_guess_cathectic_panel.find(".cathectic-odds").val(u),t.$js_guess_cathectic_panel.find(".cathectic-rest").data("rest",o).html(o),t.$js_guess_cathectic_panel.find(".js-cathectic-coin-input").val(""),t.$js_guess_cathectic_panel.find(".cathectic-winget").html("0"),void t.$js_guess_cathectic_panel.show())},fCathecticPopPanelEvent:function(){var s=this,e=s._ui;e.$js_guess_cathectic_panel.on("click",".js-close-cathectic",function(s){s.preventDefault(),e.$js_guess_cathectic_panel.closest(".guess-row").removeClass("bet-abled"),e.$js_guess_cathectic_panel.remove()}),e.$js_guess_cathectic_panel.on("click",".js-cathectic-all",function(a){a.preventDefault();var t=e.$js_guess_cathectic_panel.find(".cathectic-rest").data("rest"),i=e.$js_guess_cathectic_panel.find(".cathectic-odds").val(),n=Math.min(Math.floor(t/i),s.oRich.fReturnRich("coin"));!n&&(n=0),e.$js_guess_cathectic_panel.find(".js-cathectic-coin-input").val(n);var l=s.fCalculateWin(+n,+e.$js_guess_cathectic_panel.find(".cathectic-odds").val());e.$js_guess_cathectic_panel.find(".cathectic-winget").html(l)});var a=!-[1],t=a?"propertychange":"input";e.$js_guess_cathectic_panel.find(".cathectic-step1 .js-cathectic-coin-input").on(t,function(a){var t=$(this),i=t.val();(""==i||isNaN(i))&&(i=0);var n=s.fCalculateWin(+i,+e.$js_guess_cathectic_panel.find(".cathectic-odds").val());e.$js_guess_cathectic_panel.find(".cathectic-winget").html(n)}),e.$js_guess_cathectic_panel.on("click",".js-cathectic-send",function(e){e.preventDefault(),s.fCathectic($(this).closest("form"))})},fCathectic:function(s){var e=this,a=e._ui;if(!oPageConfig.oLoginInfo)return yp.pub("page/login"),!1;var t=a.$js_guess_cathectic_panel.find(".cathectic-qid").val(),i=a.$js_guess_cathectic_panel.find(".cathectic-aid").val(),n=a.$js_guess_cathectic_panel.find(".cathectic-banker").val(),l=s.find(".js-cathectic-coin-input").val();if(isNaN(l)||!+l)return yp.errorNotify("请填写大于0的下注金额"),!1;if(+l>+e.oRich.fReturnRich("coin"))return yp.errorNotify("对不起，您的战旗币不足，请充值"),!1;var d={guessId:t};d.bankId=+n,d.coin=+l,e.oRich.fRichUpdate(-l,"coin"),e.oBetHash[t+"-"+i]=d.bankId,e.ajax_socket("Guess.Bet",{data:d}),a.$js_guess_cathectic_panel.closest(".guess-row").removeClass("bet-abled"),a.$js_guess_cathectic_panel.remove()},fGetBankRestCoin:function(s,e,a){var t,i,n,l=this,d=0;return t=l.fGetGuessInfo(s),i=t.answers[1==e?0:1],n=i.bankers[i.bankersHash[a]],n&&(d=Math.floor(n.coin-n.rate*n.betCoin)),d},fShowBankerPanel:function(s){var e=this,a=e._ui,t=s.closest(".guess-area");return t.hasClass("makers-abled")?!1:(t.find(".bet-abled").length&&(t.find(".bet-abled").removeClass("bet-abled"),a.$js_guess_cathectic_panel.remove()),t.addClass("makers-abled").append(a.$js_guess_banker_panel),e.fSetBanker(s),void e.fSetBankerPanelEvent())},fSetBanker:function(s){var e=this,a=e._ui,t=s.closest(".guess-area").data("qid"),i=e.aGuessList[e.oGuessHash[t]];if(i.stop)return alert("该竞猜已停止坐庄"),$guess.removeClass("makers-abled"),a.$js_guess_banker_panel.remove(),!1;var n={guessId:i.guessId,guessTitle:i.guessTitle,answer1:i.answers[0].des,answer2:i.answers[1].des,coin:e.oRich.fReturnRich("coin")};a.$js_guess_banker_panel.show(),a.$js_guess_banker_panel.find(".js-baner-guess-title").html(n.guessTitle),a.$js_guess_banker_panel.find(".js-banker-guess-answer1").html(n.answer1),a.$js_guess_banker_panel.find(".js-banker-guess-answer2").html(n.answer2),a.$js_guess_banker_panel.find(".js-banker-guess-coin").html(n.coin),a.$js_guess_banker_panel.find(".js-banker-guess-id").val(n.guessId)},fSetBankerPanelEvent:function(){function s(){var s=a.$js_guess_banker_panel.find(".odds-banker").val(),e=a.$js_guess_banker_panel.find(".coin-banker").val();""==s||isNaN(s)||.1>s||s>9.9||3<s.length?a.$js_guess_banker_panel.find(".winget-banker").html("").hide():""==e||isNaN(e)||1e3>e||0!=e%100?a.$js_guess_banker_panel.find(".winget-banker").html("").hide():a.$js_guess_banker_panel.find(".winget-banker").html("输赢区间-"+e+"至+"+Math.floor(e/s)).show()}var e=this,a=e._ui;a.$js_guess_banker_panel.on("click",".js-close-banker",function(s){s.preventDefault(),a.$js_guess_banker_panel.closest(".guess-area").removeClass("makers-abled"),a.$js_guess_banker_panel.remove()}),a.$js_guess_banker_panel.on("submit",function(s){s.preventDefault(),e.fBankerSend($(this))});var t="input",i=!-[1];i&&(t="propertychange"),a.$js_guess_banker_panel.find(".odds-banker").off(t).on(t,function(){s()}),a.$js_guess_banker_panel.find(".coin-banker").off(t).on(t,function(){s()}),a.$js_guess_banker_panel[0].reset()},fBankerSend:function(s){var e=this,a=e._ui;if(!oPageConfig.oLoginInfo)return yp.pub("page/login"),!1;var t=s.find(".answer-banker"),i=0;if(yp.each(t,function(s){s.checked&&(i=s.value)}),!i)return yp.errorNotify("请选择押注的选项"),!1;var n=""+s.find(".odds-banker").val();if(""==n||isNaN(n)||.1>n||n>9.9||3<n.length)return yp.errorNotify("请填写0.1~9.9的赔率"),!1;var l=""+s.find(".coin-banker").val();if(""==l||isNaN(l)||1e3>l)return yp.errorNotify("请填写不少于1000战旗币的金额"),!1;if(0!=l%100)return yp.errorNotify("请填写100整数倍的战旗币"),!1;if(+l>+e.oRich.fReturnRich("coin"))return yp.errorNotify("对不起，您的战旗币不足，请充值"),!1;var d={guessId:s.find(".guessId-banker").val()};1==i?d.answer=1:d.answer=2,d.rate=+n,d.coin=+l,e.oRich.fRichUpdate(-l,"coin"),e.ajax_socket("Guess.Bank",{data:d}),a.$js_guess_banker_panel.closest(".guess-area").removeClass("makers-abled"),a.$js_guess_banker_panel.remove()},fGuessEnd:function(s,e){var a=this,t=a.fGetGuessInfo(s);return t&&!t.bOver&&(t.result=e,t.bOver=!0,a.nGuessCnt--,a.fCheckGuessBtn()),t},fGetGuessLen:function(){var s=this;return s.nGuessCnt}};"undefined"!=typeof module?module.exports=s:"function"==typeof define&&define.amd?define(function(){return s}):window.oGuess=s}();