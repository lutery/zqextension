+function(){var i={aGiftList:[],aGiftBeShield:null,oGiftHash:{},oAnchor:null,oRich:null,aGiftLevelClass:["","first-gifts-ibox","second-gifts-ibox","third-gifts-ibox","fourth-gifts-ibox","fifth-gifts-ibox"],bNoChatByServer:!1,$giftLayer:null,_ui:{},_tmpl:{giftList:'<li class="${giftClass}" data-tid="${tid}">                  <a href="javascript:;" class="js-gift-item" data-id="${id}">                    <i class="bg"></i>                    <img src="${icon}" alt="">                  </a>                </li>',giftInfo:'<div class="left-area">                  <img src="${image}" alt="">                </div>                <div class="right-area">                  <div class="sub-top">                    <span class="dv name">${name}</span>                    <i class="dv ${pricetype}-icon"></i>                    <span class="dv num">${price}</span>                  </div>                  <div class="note-title">${desc}</div>                  <p class="girts-fun clearfix">                    <span>赠：</span>                    <span>主播战斗力+${fight}</span>                    <span class="ml10">粉丝亲密度+${exp}</span>                  </p>                ${comboDesc}</div>',giftCombo:'<p>                    <i class="round dv"></i>                    <span class="dv">一次性赠送<span class="num">${number}</span>个触发<span class="num">${name}</span>${bro}</span>                  </p>',giftGive:'${iconHtml}                  <span class="di name">${fromname}${vIconHtml}&nbsp;</span>${getWay}送给${anchorname}<img src="${image}" alt="" class="gifts-icon png">                <span class="gifts-num">${count}</span>',giftGiveSuper:'${iconHtml}                  <span class="di name">${fromname}${vIconHtml}&nbsp;</span>${getWay}给${anchorname}${action}<span class="gifts-num">${count}</span>${classifier}                <img src="${image}" alt="" class="gifts-icon png">',giftSpecial:'<div class="send-gifts-ibox ${special_class} js-slide-gift-show" style="display: none;" data-uid="${uid}" data-tid="${tid}">                      <div class="send-gifts-inner">                        <p class="name">${fromname}</p>                        <div class="send-bottom">                          <p class="gifts-name dv">送出<span class="js-num-max-count">${count}</span>个${name}</p>${nums_area}                        </div>                        <div class="gifts-num clearfix"></div>                        <img src="${image}" alt="" class="gifts-icon">                      </div>                    </div>'},oViewer:{},oExtraGift:{tid_5:{id:"5",tid:"5",name:"男盆友",desc:"让我的臂膀变成你的城墙!",image:oPageConfig.oUrl.sUrlBase+"images/gift/new/bf.gif",mobileimg:oPageConfig.oUrl.sUrlBase+"images/gift/new/bf-mobile.png",icon:oPageConfig.oUrl.sUrlBase+"images/gift/new/bf.png",action:"邮寄",classifier:"个",status:"1",note:"",price:6600,fight:660,exp:660,coinType:2,pricetype:"gold",giftClass:"show-gifts",comboicon:oPageConfig.oUrl.sUrlBase+"images/gift/new/bf_combo.png"}},init:function(){var i=this;i.$giftLayer=$(".js-room-gift-area"),i.$specialContain=$(".js-right-chat-layer"),yp.module.fRegistModule("oGift",i),i.fLoadGiftList().done(function(t){0==t.code&&(i.aGiftList=t.data,i.aGiftBeShield=["1","2","3"],i.view(),i.bindEvent(),i.listenYPEvent(),i.listenSocketEvent(),i.fBeGiftShield(),e.init(i.$giftLayer))})},view:function(){var i=this;i._ui.$body=$("body"),i.$giftLayer.addClass(" js-for-gift-list").addClass("js-for-gift-item").append('<div class="give-area clearfix">            <div class="input-area js-gift-num-panel">              <input type="text" class="js-gift-buy-cnt-input" maxlength="4" value="1">              <input type="hidden" class="js-gift-id-input" value="0" />              <div class="drop-down">                <ul>                  <li>                    <a href="javascript:;" class="js-gift-num-item" data-num="1314">1314</a>                  </li>                  <li>                    <a href="javascript:;" class="js-gift-num-item" data-num="520">520</a>                  </li>                  <li>                    <a href="javascript:;" class="js-gift-num-item" data-num="233">233</a>                  </li>                  <li>                    <a href="javascript:;" class="js-gift-num-item" data-num="66">66</a>                  </li>                  <li>                    <a href="javascript:;" class="js-gift-num-item" data-num="25">25</a>                  </li>                  <li>                    <a href="javascript:;" class="js-gift-num-item" data-num="10">10</a>                  </li>                </ul>              </div>              <a href="javascript:;" class="arrow js-gift-num-collapse"></a>            </div>            <a href="javascript:;" class="give-btn js-buy-btn">赠送</a>          </div>          <a href="javascript:;" class="gift-btn js-gift-list-collapse"></a>          <div class="gifts-content">            <div class="gifts-mask">              <div class="gifts-area">                <ul class="clearfix js-gift-list js-for-gift-num-panel"></ul>              </div>            </div>          </div>'),i._ui.$room_fun_area_right=$(".js-room-fun-area-right");var e="";yp.each(i.aGiftList,function(e,t){1==oPageConfig.oRoom.gender&&i.oExtraGift["tid_"+e.tid]&&(i.oExtraGift["tid_"+e.tid].combo=e.combo,i.aGiftList[t]=i.oExtraGift["tid_"+e.tid],e=i.aGiftList[t]),e=i.fDealGiftInfo(e)}),fSortArr(i.aGiftList,{by:"weight",bAsc:!0}),yp.each(i.aGiftList,function(t,a){e+=i.fBuildGiftHtml(t),i.oGiftHash[t.id]=a}),i.$giftLayer.find(".js-gift-list").append(e);var t=5-i.aGiftList.length%5;t>0&&i.fAppendGiftPlaceholder(t),i._ui.$giftInfoPop=$('<div class="gifts-hover-ibox clearfix" style="display:none;">          <i class="arrow"></i>          <div class="js-gift-info-content"></div>        </div>'),i._ui.$room_fun_area_right.append(i._ui.$giftInfoPop),i._ui.$js_gift_shield=$("#js-gift-shield"),i._ui.$js_gift_shield_notice=$(".js-gift-shield-notice"),i._ui.$lucky_gift_panel=$("#js-lucky-gift-panel")},bindEvent:function(){var i=this,t=i._ui;i.$giftLayer.on("mouseenter",".js-gift-item",function(){var a,o=$(this),n=o.data("id"),s="";try{a=i.aGiftList[i.oGiftHash[n]]}catch(f){}if(!a)return!1;s=yp.format(i._tmpl.giftInfo,a),t.$giftInfoPop.show().toggleClass("rose-hover-ibox",!!a.comboDesc).find(".js-gift-info-content").html(s),e.fFireGiftInfoHideNow();var l=o.offset(),r=t.$room_fun_area_right.offset(),c=l.left-r.left-(t.$giftInfoPop.outerWidth()-o.outerWidth())/2,u=l.top-r.top-t.$giftInfoPop.outerHeight()-10;t.$giftInfoPop.css({left:c,top:u})}).on("mouseleave",".js-gift-item",function(){t.$giftInfoPop.hide()}),i.$giftLayer.on("click",".js-buy-btn",function(e){e.preventDefault(),i.fBuyGift()});var a=0;t.$js_gift_shield.on("click",function(e){e.preventDefault(),i.beGiftShield=!i.beGiftShield;var o=new Date;o.setTime(o.getTime()+31536e6),$.cookie("beGiftShield",i.beGiftShield?1:0,{expires:o,path:"/"}),t.$js_gift_shield.toggleClass("refreshingBtn-show-icon",i.beGiftShield),a&&clearTimeout(a),t.$js_gift_shield_notice.stop().fadeIn(function(){a=setTimeout(function(){t.$js_gift_shield_notice.fadeOut()},2e3)}).find(".js-gift-shield-notice-content").html(i.beGiftShield?"您已屏蔽小礼物的显示":"您已恢复小礼物的显示")}),t.$lucky_gift_panel.on("click",".js-close",function(){t.$lucky_gift_panel.hide()}),i.$giftLayer.on("click",".js-gift-list-collapse",function(){i.$giftLayer.hasClass("open-gifts")?i.fCloseGiftListPanel():i.fOpenGiftListPanel()}),i.$giftLayer.on("click",".js-gift-num-collapse",function(){i.$giftLayer.find(".js-gift-num-panel").hasClass("open-num")?i.fCloseGiftNumPanel():i.fOpenGiftNumPanel()}),i.$giftLayer.on("click",".js-gift-item",function(){var e=$(this);e.hasClass("active")?i.fGiftUnSelect():i.fGiftSelect(e)});var o="input",n=window.ie678;n&&(o="propertychange"),i.$giftLayer.find(".js-gift-buy-cnt-input").off(o).on(o,function(i){var e=$(this),t=e.val(),a=e.data("last");t=""+t,t&&0>=+t||isNaN(t)||-1<t.indexOf(".")?e.val(a):e.data("last",t)}),i.$giftLayer.on("click",".js-gift-num-item",function(e){e.preventDefault();var t=$(this).data("num");i.$giftLayer.find(".js-gift-buy-cnt-input").val(t).data("last",t).focus()})},fOpenGiftListPanel:function(){var i=this,e=i._ui;i.$giftLayer.addClass("open-gifts"),setTimeout(function(){e.$body.off("click.giftList").on("click.giftList",function(e){e.preventDefault();var t=$(e.target);t.hasClass(".js-for-gift-list")||0!=t.closest(".js-for-gift-list").length||i.fCloseGiftListPanel()})},0)},fCloseGiftListPanel:function(){var i=this,e=i._ui;i.$giftLayer.removeClass("open-gifts"),e.$body.off("click.giftList")},fGiftSelect:function(i){var e=this,t=e._ui;e.fGiftUnSelect(),i.addClass("active"),e.$giftLayer.find(".js-gift-id-input").val(i.data("id")),setTimeout(function(){t.$body.off("click.giftItem").on("click.giftItem",function(i){i.preventDefault();var t=$(i.target);t.hasClass(".js-for-gift-item")||0!=t.closest(".js-for-gift-item").length||e.fGiftUnSelect()})},0)},fGiftUnSelect:function(){var i=this,e=i._ui;i.$giftLayer.find(".js-gift-item.active").removeClass("active"),e.$body.off("click.giftItem"),i.$giftLayer.find(".js-gift-id-input").val(0),i.$giftLayer.find(".js-gift-buy-cnt-input").val(1).data("last",1)},fOpenGiftNumPanel:function(){var i=this,e=i._ui;i.$giftLayer.find(".js-gift-num-panel").addClass("open-num"),setTimeout(function(){e.$body.off("click.giftNum").on("click.giftNum",function(e){e.preventDefault();var t=$(e.target);t.hasClass(".js-for-gift-num-panel")||0!=t.closest(".js-for-gift-num-panel").length||i.fCloseGiftNumPanel()})},0)},fCloseGiftNumPanel:function(){var i=this,e=i._ui;i.$giftLayer.find(".js-gift-num-panel").removeClass("open-num"),e.$body.off("click.giftNum")},listenYPEvent:function(){var i=this;i._ui;yp.sub("page/bNoChatByServer",function(e,t){i.bNoChatByServer=t.bNoChatByServer}),yp.sub("page/chatlist/open",function(){i.fGiftSpecialCss(!1)}),yp.sub("page/halfguest/change",function(e,t){i.roomStatus.halfguest=t.state,t.state||(i.giftWait=0)}),yp.sub("page/room/viewer/login",function(){i.roomStatus.halfguest=0,i.giftWait=0}),yp.sub("page/room/gift/show",function(e,t){i.fGiftSpecialShow(t)}),yp.sub("page/room/viewer/login",function(e,t){i.oViewer=t}),yp.sub("page/room/viewer/update",function(e,t){i.oViewer=t}),yp.sub("page/room/gift/myself",function(e,t){var a=i.aGiftList[i.oGiftHash[t.pid]],o={id:t.pid,count:t.count,object:oPageConfig.oRoom.uid,anchorname:oPageConfig.oRoom.nickname,uid:oPageConfig.oLoginInfo?oPageConfig.oLoginInfo.uid:0,nickname:i.oViewer?i.oViewer.nickname:oPageConfig.oLoginInfo.nickname,show:i.oViewer.showmedal||0,level:i.oViewer.level||0,permission:i.oViewer?i.oViewer.permission:0,brotype:6==a.tid||7==a.tid||14==a.tid?1:0,tid:a.tid,type:1,vlevel:i.oViewer.vlevel||0,vdesc:i.oViewer.vdesc||"",slevel:i.oViewer.slevel||0,pos:i.oViewer.pos||0,stype:i.oViewer.stype||0,richertitle:i.oViewer.richertitle||"",guard:i.oViewer.guard||0,ams:i.oViewer.ams||""};o.content=i.fGiftGiveHtml(o),yp.pub("page/gift/use",{fromid:o.gid,content:o.content,myself:"",style:""})}),yp.sub("page/gift/buy",function(){i.fBuyGift()}),yp.sub("page/otherGift/show",function(e,t){i.fDoGiftSpecialShow(t)}),yp.sub("page/gift/buy/pop",function(e,t){i.fGiftSelect(t.$gift)}),yp.sub("page/document/vidible",function(){"hidden"==yp.documentVisible&&i.fGfitShowNext()})},roomStatus:{halfguest:0},giftWait:0,listenSocketEvent:function(){var i=this;i._ui;$.topic("msgc/Gift.Use").sub(function(e){return oPageConfig.oLoginInfo&&e.data.uid!=oPageConfig.oLoginInfo.uid&&i.beGiftShield&&-1!=$.inArray(""+e.data.tid,i.aGiftBeShield)?!1:oPageConfig.oRoom.uid==e.object?!1:void(oPageConfig.oLoginInfo&&e.data.uid==oPageConfig.oLoginInfo.uid&&2!=e.data.type||e.data.object==oPageConfig.oRoom.uid&&(35<e.data.slevel&&(e.data.slevel=0),9<e.data.pos&&(e.data.pos=0),e.data.content=i.fGiftGiveHtml(e.data),yp.pub("page/gift/use",{fromid:e.data.gid,content:e.data.content,myself:"",style:""})))}),$.topic("msgc/Gift.Show").sub(function(e){return e.data?void yp.each(e.data,function(e){i.fSuperGiftSpecialShow(e)}):!1}),$.topic("msgc/Gift.Auto").sub(function(e){var t=i.fDealGiftInfo(e.data),a=i.fBuildGiftHtml(t);if(i.$giftLayer.find('.js-gift-item[data-id="'+t.id+'"]').length)i.aGiftList[i.oGiftHash[t.id]]=t,i.$giftLayer.find('li[data-tid="'+t.tid+'"]').replaceWith($(a));else if(i.$giftLayer.find('li[data-tid="'+t.tid+'"]').length)i.oGiftHash[t.id]?i.aGiftList[i.oGiftHash[t.id]]=t:(i.oGiftHash[t.id]=i.aGiftList.length,i.aGiftList.push(t)),i.$giftLayer.find('li[data-tid="'+t.tid+'"]').replaceWith($(a));else{i.oGiftHash[t.id]?i.aGiftList[i.oGiftHash[t.id]]=t:(i.oGiftHash[t.id]=i.aGiftList.length,i.aGiftList.push(t));var o=!1;yp.each(i.$giftLayer.find(".js-gift-list li"),function(i){var e=$(i);return e.data("tid")<t.tid?(e.before(a),o=!0,!1):void 0}),o||i.fAppendGiftItem(a)}}),$.topic("msgc/Gift.Hidden").sub(function(e){i.$giftLayer.find('li[data-tid="'+e.data.tid+'"]').remove(),i.fAppendGiftPlaceholder(1)}),$.topic("msgc/giftanimationend").sub(function(){i.fGfitShowNext()}),$.topic("msgc/mgcomplete").sub(function(){i.fGfitShowNext()}),$.topic("msgc/checkipsafe").sub(function(){yp.use("checkMobile",function(e,t){t.init(),e.pub("page/checkmobile/show",{bGotCode:!0,params:{roomId:oPageConfig.oRoom.id},ajaxUrl:"/api/user/user.safe_check",callback:function(i){0==i.code&&e.successNotify("验证成功")},selfCall:i})})}),$.topic("msgc/Gift.AprilAcitve").sub(function(e){i.fDabaojianFlash(e.data)}),$.topic("msgc/Gift.AprilAwardNotify").sub(function(e){var t=[];yp.each(e.award,function(i,e){t.push(i+"个"+e+"金币")}),i._ui.$lucky_gift_panel.length?(i._ui.$lucky_gift_panel.show(),i._ui.$lucky_gift_panel.find(".js-lucky-gift-content").html("您中了"+t.join("，")+"<br />总计"+e.total+"金币"),i._ui.$lucky_gift_panel.css({top:$(window).scrollTop()+20,zIndex:101,marginTop:0})):alert('<div class="info">              <div class="no-subscription-list">                <i class="qn-logo dv"></i>                <p class="text dv" style="width: 240px;text-align:left;">恭喜你中了'+t.join("，")+"<br />累积金币"+e.total+'<br /><br />                  <a href="/user/wallet/log.gold" target="_blank" style="color:#0372cf;">查看中奖详情 >></a>                </p>              </div>            </div>',"","",{width:370})}),$.topic("msgc/Level.WeekTip").sub(function(e){i.fShowWeekTips(e.data)});var e;$.topic("msgc/Gold.UpCheck").sub(function(i){e=i.phone?$.ibox({title:"提示信息",content:'<p style="font-size: 14px;text-align: left;line-height: 22px;padding: 0 10px;">消费验证短信已发送到<span style="color: red">'+i.phone+"</span>，请注意查收<br />请根据短信提示进行操作！若手机上已经完成操作，请点击“已完成”！</p>",btns:[{name:"已完成"}],width:370}):$.ibox({title:"提示信息",content:'<p style="font-size: 14px;text-align: left;line-height: 22px;padding: 0 10px;">请先前往绑定手机</p>',btns:[{name:"确定",callback:function(){window.open("/user/safeBind")}}],width:370})}),$.topic("msgc/notebcheck").sub(function(i){oPageConfig.oLoginInfo&&oPageConfig.oLoginInfo.uid==i.uid&&oPageConfig.oRoom.id==i.roomid&&(e&&e.close(),1==i.status?alert("财富安全校验失败"):2==i.status&&alert("财富安全校验成功"))})},ajax_socket:function(i,e){return this.bNoChatByServer?!1:(e=e||{},yp.ajax(i,{type:"socket",data:e}))},beGiftShield:!1,fBeGiftShield:function(){var i=this,e=i._ui;i.beGiftShield=1==$.cookie("beGiftShield"),e.$js_gift_shield.toggleClass("refreshingBtn-show-icon",i.beGiftShield)},fBuyGift:function(){var i=this;i._ui;if(!oPageConfig.oLoginInfo)return yp.pub("page/login"),!1;if(oPageConfig.oLoginInfo&&oPageConfig.oRoom.uid==oPageConfig.oLoginInfo.uid)return yp.errorNotify("抱歉，不能给自己赠送礼物"),!1;var e=i.$giftLayer.find(".js-gift-buy-cnt-input").val(),t=i.$giftLayer.find(".js-gift-id-input").val();if(!t)return!1;var a;try{a=i.aGiftList[i.oGiftHash[t]]}catch(o){}if(!a||2==a.status)return!1;if(0>=e||!e||isNaN(e))return yp.errorNotify("请填写正确购买数量"),!1;var n=2==a.coinType?"gold":"coin",s=a.price*e;if(!i.oRich.fReturnRich("goldEnable"))return alert("金币被冻结，无法使用！"),!1;if(s>i.oRich.fReturnRich(n))return"coin"==n?yp.errorNotify("您的战旗币不足！"):0<i.oRich.fReturnRich("goldLocked")?alert("你有未解冻的金币，请在游戏结束后再送礼"):yp.pub("page/alipay/qrcode/pay",{show:1,gold:s-i.oRich.fReturnRich(n),type:"alipay"}),!1;if(i.roomStatus.halfguest){var f=3e5;return 0<i.giftWait?f=f-$.now()+i.giftWait:i.giftWait=$.now(),f>0?(f=Math.ceil(f/6e4),alert("礼物还在补仓中，请耐心等待"+f+"分钟……")):confirm("礼物貌似补足了，是否再次尝试？","","",{btns:[{name:"尝试",callback:function(){yp.pub("page/closeSocket",{relogin:!0}),this.close()}},{name:"取消"}]}),!1}i.oRich.fRichUpdate(-s,n),i.ajax_socket("Gift.Use",{pid:+t,count:+e}),yp.pub("page/room/gift/myself",{pid:+t,count:+e}),oPageConfig.giftSource&&_hmt.push(["_trackEvent","gift_"+a.tid,"gift_"+a.tid+"_"+oPageConfig.giftSource]),yp.successNotify("赠送成功")},fGiftGiveHtml:function(i){var e=this,t=e.aGiftList[e.oGiftHash[i.id]],a="";if(!t){if(!e.$giftLayer.find('.js-gift-list li[data-tid="'+i.tid+'"]').length)return!1;t=e.aGiftList[e.oGiftHash[e.$giftLayer.find('.js-gift-list li[data-tid="'+i.tid+'"] .js-gift-item').data("id")]]}yp.pub("page/gift/show",{oGiftInfo:t,count:i.count});var o={172:"rose",196:"banzhuan",244:"taidi",245:"laoe",246:"lv",247:"lv",6:"baojian"};if(o[t.id]){var n=i.count;("laoe"==o[t.id]||"lv"==o[t.id])&&(n=3*n),e.fAppendSuperGiftFlash({type:o[t.id],count:n})}else{var s=t.combo;yp.each(s,function(a){return a.number==i.count?(e.fAppendSuperGiftFlash({type:"combo",count:1,swf:oPageConfig.oUrl.sUrlFlash+"multiGS/MultiGiftShow.swf?"+yp.config.flashVer,IconUrl:t.comboicon,StyleUrl:a.css}),!1):void 0})}var f=2==t.coinType?"gold":"coin",l=t.price*i.count,r=0;r="coin"==f?l/1e3:l/100,r>=1&&oPageConfig.oRoom.uid==i.object&&1!=i.brotype&&e.fGiftSpecialShow(i);var c;c=1==oPageConfig.oRoom.gender&&e.oExtraGift["tid_"+t.tid]&&1==i.type?e.oExtraGift["tid_"+t.tid]:t;var u={anchorname:oPageConfig.oRoom.uid==i.object?"主播":i.anchorname,fromname:i.nickname,image:c.image,count:i.count,iconHtml:"",getWay:2==i.type?"通过发送弹幕":"",vIconHtml:"",level:i.level,permission:i.permission,uid:i.uid,iconHtml:"",slevel:i.slevel,pos:i.pos,guard:i.guard,ams:i.ams};return i.vlevel&&(u.vIconHtml=yp.module.fCallFun("oMainData","fReturnVIconHtml",[i])),u=yp.module.fCallFun("oMainData","fReturnIconHtml",[u,"gift"]),""==t.action?a=yp.format(e._tmpl.giftGive,u):(u.action=c.action,u.classifier=c.classifier,a=yp.format(e._tmpl.giftGiveSuper,u)),a},$specialContain:null,fGiftSpecialShow:function(i){var e=this;e._ui;e.fDoGiftSpecialShow(i)},fDoGiftSpecialShow:function(i){var e,t=this,a=(t._ui,0),o="";e=1==oPageConfig.oRoom.gender&&t.oExtraGift["tid_"+i.tid]&&1==i.type?t.oExtraGift["tid_"+i.tid]:t.aGiftList[t.oGiftHash[t.$giftLayer.find('.js-gift-list li[data-tid="'+i.tid+'"] .js-gift-item').data("id")]],a=t.fReturnGiftLevel(e);var n={fromname:i.nickname,anchorname:oPageConfig.oRoom.uid==i.object?"主播":i.anchorname,image:e.image,name:e.name,uid:i.uid,tid:i.tid,special_class:t.aGiftLevelClass[a],nums_area:"",count:i.count};e.combo&&e.combo.length&&yp.each(e.combo,function(e){e.number==i.count&&(n.special_class+=" send-batter-ibox")}),o=yp.format(t._tmpl.giftSpecial,n);var s=$(o),f=t.fGiftSpecialCss(!0);t.$specialContain.append(s),s.css({left:t.$specialContain.width(),top:f}).show();var l,r,c=(s.find(".name").width(),!0),u=0,d=$.Deferred(),g=$.Deferred();1==i.tid||3==i.tid?(r=Math.floor(.05*i.count*(1+Math.pow(.8,i.count/50))*1e3),l=Math.floor(r/i.count),l=Math.min(l,500),20<i.count&&(c=!1,u=Math.floor((r-1540)/(i.count-10)))):8==i.tid?(r=Math.floor(1.2*i.count*(1+Math.pow(.8,i.count/50))*1e3),l=Math.floor(r/i.count),l=Math.min(l,500)):4==i.tid?(r=Math.floor(3*i.count*(1+Math.pow(.8,i.count/2))*1e3),l=Math.floor(r/i.count),l=Math.min(l,300)):5==i.tid?(r=Math.floor(22*i.count*(1+Math.pow(.8,i.count/2))*1e3),l=Math.floor(r/i.count),l=Math.min(l,300)):10==i.tid?(r=Math.floor(.8*i.count*(1+Math.pow(.8,i.count/50))*1e3),l=Math.floor(r/i.count),l=Math.min(l,500)):13==i.tid&&(r=Math.floor(35*i.count*(1+Math.pow(.8,i.count/2))*1e3),l=Math.floor(r/i.count),l=Math.min(l,300)),setTimeout(function(){g.resolve()},r),s.animate({left:0},300,function(){t.fNumberAnimate(i.count,l,s,function(){d.resolve()},c,u)}),$.when(d,g).done(function(){setTimeout(function(){s.fadeOut("fast",function(){s.remove(),t.fGiftSpecialCss(!1)})},1e3)})},oSuperEventQuery:{},oSuperEventUser:{},fSuperGiftSpecialShow:function(i){var e=this;e._ui;if(6!=i.tid&&7!=i.tid&&14!=i.tid)return!1;!e.oSuperEventQuery[i.uid+"_"+i.tid]&&(e.oSuperEventQuery[i.uid+"_"+i.tid]={});var t=Math.ceil(+i.totalLeftTime/+i.cacheTime),a=i.count-t;return i.curIndex=a,e.oSuperEventQuery[i.uid+"_"+i.tid].count&&e.oSuperEventQuery[i.uid+"_"+i.tid].count>=i.count?!1:(e.oSuperEventQuery[i.uid+"_"+i.tid]=i,void(e.oSuperEventUser[i.uid+"_"+i.tid]?(e.oSuperEventUser[i.uid+"_"+i.tid].$specialGift.find(".js-num-max-count").html(i.count),e.fSuperGiftSpecialAddZero(e.oSuperEventUser[i.uid+"_"+i.tid].$specialGift,i.count)):e.fDoSuperGiftSpecialShow(i.uid,i.tid)))},fSuperGiftSpecialShowClear:function(i,e){var t=this;t.oSuperEventQuery[i+"_"+e]={},clearTimeout(t.oSuperEventUser[i+"_"+e].timeout),t.oSuperEventUser[i+"_"+e].$specialGift.remove(),t.oSuperEventUser[i+"_"+e]=null,t.fGiftSpecialCss(!1)},fDoSuperGiftSpecialShow:function(i,e){var t=this,a=(t._ui,0),o=t.oSuperEventQuery[i+"_"+e];if(!o.count||t.oSuperEventUser[i+"_"+e])return!1;var n;n=1==oPageConfig.oRoom.gender&&t.oExtraGift["tid_"+e]&&1==o.type?t.oExtraGift["tid_"+e]:t.aGiftList[t.oGiftHash[t.$giftLayer.find('.js-gift-list li[data-tid="'+e+'"] .js-gift-item').data("id")]],a=t.fReturnGiftLevel(n);var s=t.aGiftList[t.oGiftHash[o.id]],f="",l={fromname:o.nickname,anchorname:oPageConfig.oRoom.uid==o.object?"主播":o.anchorname,image:n?n.image:s.image,name:n?n.name:s.name,uid:o.uid,tid:o.tid,special_class:t.aGiftLevelClass[a],nums_area:"",count:o.count};f=yp.format(t._tmpl.giftSpecial,l),!t.oSuperEventUser[o.uid+"_"+o.tid]&&(t.oSuperEventUser[o.uid+"_"+o.tid]={});var r=$(f),c=t.fGiftSpecialCss(!0);t.$specialContain.append(r),r.css({left:t.$specialContain.width(),top:c}).show();r.find(".name").width();t.oSuperEventUser[o.uid+"_"+o.tid].$specialGift=r,r.animate({left:0},300,function(){t.fDoSuperGiftSpecialAnimate(r,o)})},fDoSuperGiftSpecialAnimate:function(i,e){var t=this,a=(t._ui,$.Deferred()),o=$.Deferred(),n=0;n=Math.min(Math.max(e.totalLeftTime-(e.count-e.curIndex-1)*e.cacheTime,0),e.cacheTime),t.oSuperEventUser[e.uid+"_"+e.tid].timeout=setTimeout(function(){o.resolve()},n),t.fNumberAnimateTo(e.curIndex+1,e.count,i,100,function(){a.resolve()}),$.when(a,o).done(function(){e.curIndex<t.oSuperEventQuery[e.uid+"_"+e.tid].count-1?(e.curIndex++,t.oSuperEventQuery[e.uid+"_"+e.tid].curIndex=e.curIndex,t.fDoSuperGiftSpecialAnimate(i,t.oSuperEventQuery[e.uid+"_"+e.tid])):i.fadeOut("fast",function(){t.fSuperGiftSpecialShowClear(e.uid,+e.tid)})})},fSuperGiftSpecialAddZero:function(i,e){e=""+e;for(var t=i.find(".gifts-num"),a=t.find(".num-ul"),o=a.length,n=e.length,s=n-o,f=230,l=s-1;l>=0;l--)a.eq(0).before('<span class="nums num-0 num-ul" data-num="0" style="height: '+2*f+'px;" data-index="'+(l+o-1)+'"></span>')},fGiftSpecialCss:function(i){var e=this,t=e.$specialContain.find(".js-slide-gift-show");if(!i&&0==t.length)return!1;var a=75*t.length,o=e.$specialContain.height(),n=0;return i&&(a+=75),n=(o-a)/2,yp.each(t,function(i){$(i).css({top:n}),n+=75}),i?n:void 0},fReturnGiftLevel:function(i){var e=i.price,t=[0,100,1e3,1e4,7e4],a=5;return 1==i.coinType&&(e/=10),yp.each(t,function(i,t){return i>e?(a=t,!1):void 0}),a},fAnchorChange:function(){var i=this;for(var e in i.oSuperEventUser)clearTimeout(i.oSuperEventUser[e].timeout),i.oSuperEventUser[e].$specialGift.remove(),i.oSuperEventUser[e]=null;i.oSuperEventQuery={},i.oSuperEventUser={},i.$specialContain.find(".send-gifts-ibox, .yanhua-gifts-ibox").remove(),i.fGiftSpecialCss(!1),i.fLoadGiftList().done(function(i){0==i.code&&yp.each(i.data,function(i){$('.js-gift-list .js-gift-item[data-id="'+i.id+'"]')||$.topic("msgc/Gift.Auto").pub({data:i})})})},fNumberAnimate:function(i,e,t,a,o,n){i=""+i;var s=this,f='<i class="symbol"></i>',l=i.length,r=t.find(".gifts-num"),c=230;r.data("max",i);for(var u=0;l>u;u++)f+='<span class="nums num-0 num-ul" data-num="0" style="height: '+c+'px" data-index="'+u+'"></span>',c=10*c;r.html(f),o?s.fNumScrollUniformSpeed(r.find(".num-ul").last(),r,e,!0,0,a):(n=Math.max(1,n),n=Math.min(n,e),s.fNumScrollUniformSpeed(r.find(".num-ul").last(),r,n,!1,0,a))},fNumScrollUniformSpeed:function(i,e,t,a,o,n){var s=this,f=23,l=+i.data("num")+1,r=l*f,c=i.data("index"),u=c-1,d=t,g=+e.data("max");if(!a){var p=[300,200,100,90,80];c==e.find(".num-ul").length-1&&(d=g/2>o?p[o]||d:p[g-o-1]||d)}0==l%10&&u>=0&&s.fNumScrollUniformSpeed(e.find(".num-ul").eq(u),e,d),i.animate({marginTop:"-"+r+"px"},d,function(){i.data("num",l),c==e.find(".num-ul").length-1&&(o++,o==g?n&&n.call(s):s.fNumScrollUniformSpeed(i,e,t,a,o,n))})},fNumberAnimateTo:function(i,e,t,a,o){i=""+i,e=""+e;var n=this,s=t.find(".gifts-num"),f=i.length,l=e.length,r=l-f,c=23,u=230;if(!s.html()){var d='<i class="symbol"></i>';s.data("max",e);for(var g=0;l>g;g++)d+='<span class="nums num-0 num-ul" data-num="0" style="height: '+2*u+'px;" data-index="'+g+'"></span>';s.html(d)}for(var g=0;r>g;g++)i="0"+i;for(var p,h,m,v=s.find(".num-ul"),y=v.length,g=y-1;g>=0;g--)p=v.eq(g),p.stop(1,1),h=parseInt(p.css("marginTop")),0-u>=h&&(h+=u,p.css({marginTop:h})),m=0-+i[g]*c,h!=m?(m>h&&(m-=u),p.animate({marginTop:m},a,function(){l=n.fNumberAnimateToCheck(l,o)})):l=n.fNumberAnimateToCheck(l,o)},fNumberAnimateToCheck:function(i,e){var t=this;return i--,0>=i&&e&&e.call(t),i},aAlwaysShow:[6,5,4,3,1],fBuildGiftHtml:function(i){var e=this,t="";return oPageConfig.aShowGift&&-1==$.inArray(i.tid,oPageConfig.aShowGift)?t:t=yp.format(e._tmpl.giftList,i)},fDealGiftInfo:function(i){var e=this;i.comboDesc="",i.combo.length&&(i.comboDesc+='<div class="rose-title">',fSortArr(i.combo,{by:"number",bAsc:!0}),yp.each(i.combo,function(t){t.bro=1==t.broadcast?"，并全站公告":"",i.comboDesc+=yp.format(e._tmpl.giftCombo,t)}),i.comboDesc+="</div>"),i.pricetype=2==i.coinType?"gold":"coin",i.weight=0,i.giftClass="";var t=$.inArray(+i.tid,e.aAlwaysShow);return t>-1&&(i.weight=+t+1,i.giftClass="show-gifts"),i},aFlashType:[],fAppendSuperGiftFlash:function(i){var e=this;e.aFlashType.push(i),1==e.aFlashType.length&&e.fShowSuperGiftFlash()},fShowSuperGiftFlash:function(){var i=this,e=i._ui;if(e.$giftFlashPanel||i.fAppendSuperGiftFlashPanel(),"hidden"==yp.documentVisible)return i.fGfitShowNext(),!1;var t=$("#BFPlayerID"),a=t.outerWidth(),o=t.outerHeight(),n={marginLeft:(0-a)/2,marginTop:(0-o)/2,width:a,height:o,top:"50%",left:"50%",position:"absolute",zIndex:1},s="",f=i.aFlashType[0],l={};switch(f.type){case"dabaojian":var r=[oPageConfig.oUrl.sUrlBase+"i/lucky/flash/Scene1.swf",oPageConfig.oUrl.sUrlBase+"i/lucky/flash/Scene2.swf",oPageConfig.oUrl.sUrlBase+"i/lucky/flash/Scene3.swf",oPageConfig.oUrl.sUrlBase+"i/lucky/flash/Scene4.swf",oPageConfig.oUrl.sUrlBase+"i/lucky/flash/Scene5.swf"];s=r[f.level-1];break;case"baojian":s=oPageConfig.oUrl.sUrlBase+"images/giftswf/baojian.swf?v="+yp.config.ver;break;case"rose":s=oPageConfig.oUrl.sUrlBase+"images/giftswf/rose.swf?v="+yp.config.ver;break;case"combo":l.icon=f.IconUrl,l.type=f.StyleUrl,l.RoomId=oPageConfig.oRoom.id,l.uID=i.oViewer.uid,l.gID=i.oViewer.gid,s=f.swf;break;case"banzhuan":s=oPageConfig.oUrl.sUrlBase+"images/banzhuan.swf",n.width=400,n.height=400,n.marginLeft=-200,n.marginTop=-200;break;case"taidi":case"laoe":case"lv":s=oPageConfig.oUrl.sUrlBase+"images/giftswf/"+f.type+".swf",n.width=600,n.height=360,n.marginLeft=-300,n.marginTop=-180}e.$giftFlashPanel.show().css(n).find(".js-gift-flash-area").html('<div id="js-gift-flash-314"></div>'),swfobject.embedSWF(s,"js-gift-flash-314","100%","100%","11.0.0","",l,{wmode:"transparent",allowScriptAccess:"always"},{id:"js-gift-flash-item-314"})},fAppendSuperGiftFlashPanel:function(){var i=this,e=(i._ui,"");e='<div class="loveDay-ibox" style="display:none;"><div class="flash js-gift-flash-area"></div></div>',i._ui.$giftFlashPanel=$(e),$("#js-flash-panel").append(i._ui.$giftFlashPanel)},fGfitShowNext:function(){var i=this;i._ui;return i.fGfitShowRemove(),i.aFlashType.length?(i.aFlashType[0].count--,0>=i.aFlashType[0].count&&i.aFlashType.shift(),void(0<i.aFlashType.length&&i.fShowSuperGiftFlash())):!1},fGfitShowRemove:function(){var i=this,e=i._ui;return e.$giftFlashPanel?(e.$giftFlashPanel.find(".js-gift-flash-area").html(""),void e.$giftFlashPanel.hide()):!1},fDabaojianFlash:function(i){var e=this,t={type:"dabaojian",count:Math.min(10,i.count),level:i.level};if(0==i.level)return!1;if(0==e.aFlashType.length)e.aFlashType.push(t),e.fShowSuperGiftFlash();else{var a=0;yp.each(e.aFlashType,function(i,e){return"dabaojian"==i.type?(a=e,!1):void 0}),e.aFlashType.splice(a,0,t)}},fShowWeekTips:function(i){if(10<i.rank)return!1;i.cnt=10*i.cnt;var e,t=this,a='<div class="week-remind-ibox clearfix js-week-tips">                        <div class="left"></div>                        <div class="right">                          <p>继续赠送<span class="num">'+(99999<i.cnt?Math.ceil(i.cnt/1e3)+"K":i.cnt)+"</span>金币的礼物,晋级贡献周榜第<span>"+i.rank+"</span>名</p>                        </div>                      </div>",o=$(a),n=t.$specialContain.find(".js-week-tips"),s=n.length;yp.each(n,function(i,a){e=$(i),a==s-1?e.css({bottom:e.outerHeight()+1}):t.fRemoveWeekTips(e)}),t.$specialContain.append(o),o.data("timeout",setTimeout(function(){t.fRemoveWeekTips(o)},2e3))},fRemoveWeekTips:function(i){i.data("timeout")&&clearTimeout(i.data("timeout")),i.remove()},fLoadGiftList:function(){return yp.ajax("/api/static/v2.1/gifts/"+oPageConfig.oRoom.id+".json",{type:"get",data:{_v:Math.floor($.now()/6e4)},dataType:"json"})},fAppendGiftPlaceholder:function(i){for(var e=this,t=(e._ui,""),a=0;i>a;a++)t+='<li class="js-gift-placeholder"><a></a></li>';e.$giftLayer.find(".js-gift-list").prepend(t)},fAppendGiftItem:function(i){var e=this,t=e.$giftLayer.find(".js-gift-placeholder");0<t.length?t.last().replaceWith($(i)):(e.$giftLayer.find(".js-gift-list").prepend(i),e.fAppendGiftPlaceholder(4))}},e={_ui:{},aFireGiftInfo:["","",{name:"白银烟花",info:"房间人数达标最多可向在线用户发放2千金币，2万战旗币。",attr:["超炫礼物特效显示。","聊天区礼物横幅显示5分钟。"],flashUrl:oPageConfig.oUrl.sUrlBase+"images/yanhua/swf/silver.swf?v="+yp.config.ver,imageUrl:oPageConfig.oUrl.sUrlBase+"images/yanhua/image/silver.png",iconUrl:oPageConfig.oUrl.sUrlBase+"images/yanhua/icon/silver.png",fireGold:"2000",pos:"白银",intPos:2,level:6},{name:"黄金烟花",info:"房间人数达标最多可向在线用户发放5千金币，5万战旗币。",attr:["超炫礼物特效显示。","聊天区礼物横幅显示5分钟。"],flashUrl:oPageConfig.oUrl.sUrlBase+"images/yanhua/swf/gold.swf",imageUrl:oPageConfig.oUrl.sUrlBase+"images/yanhua/image/gold.png",iconUrl:oPageConfig.oUrl.sUrlBase+"images/yanhua/icon/gold.png",fireGold:"5000",pos:"黄金",intPos:3,level:11},{name:"白金烟花",info:"房间人数达标最多可向在线用户发放1万金币，10万战旗币。",attr:["全站广播烟花通知。","超炫礼物特效显示。"],flashUrl:oPageConfig.oUrl.sUrlBase+"images/yanhua/swf/platinum.swf",imageUrl:oPageConfig.oUrl.sUrlBase+"images/yanhua/image/platinum.png",iconUrl:oPageConfig.oUrl.sUrlBase+"images/yanhua/icon/platinum.png",fireGold:"10000",pos:"白金",intPos:4,level:16},{name:"钻石烟花",info:"房间人数达标最多可向在线用户发放2万金币，20万战旗币。",attr:["全站广播烟花通知。","超炫礼物特效显示。"],flashUrl:oPageConfig.oUrl.sUrlBase+"images/yanhua/swf/diamond.swf",imageUrl:oPageConfig.oUrl.sUrlBase+"images/yanhua/image/diamond.png",iconUrl:oPageConfig.oUrl.sUrlBase+"images/yanhua/icon/diamond.png",fireGold:"20000",pos:"钻石",intPos:5,level:21},{name:"大师烟花",info:"房间人数达标最多可向在线用户发放3万金币，30万战旗币。",attr:["全站广播烟花通知。","超炫礼物特效显示。"],flashUrl:oPageConfig.oUrl.sUrlBase+"images/yanhua/swf/master.swf",imageUrl:oPageConfig.oUrl.sUrlBase+"images/yanhua/image/master.png",iconUrl:oPageConfig.oUrl.sUrlBase+"images/yanhua/icon/master.png",fireGold:"30000",pos:"大师",intPos:6,level:26},{name:"王者烟花",info:"房间人数达标最多可向在线用户发放4万金币，40万战旗币。",attr:["全站广播烟花通知。","超炫礼物特效显示。"],flashUrl:oPageConfig.oUrl.sUrlBase+"images/yanhua/swf/king.swf",imageUrl:oPageConfig.oUrl.sUrlBase+"images/yanhua/image/king.png",iconUrl:oPageConfig.oUrl.sUrlBase+"images/yanhua/icon/king.png",fireGold:"40000",pos:"王者",intPos:7,level:31},{name:"神烟花",info:"房间人数达标最多可向在线用户发放5万金币，50万战旗币。",attr:["全站广播烟花通知。","超炫礼物特效显示。"],flashUrl:oPageConfig.oUrl.sUrlBase+"images/yanhua/swf/king.swf",
imageUrl:oPageConfig.oUrl.sUrlBase+"images/yanhua/image/god.png",iconUrl:oPageConfig.oUrl.sUrlBase+"images/yanhua/icon/god.png",pos:"神",intPos:8},{name:"创世神烟花",info:"房间人数达标最多可向在线用户发放10万金币，100万战旗币。",attr:["全站广播烟花通知。","超炫礼物特效显示。"],flashUrl:oPageConfig.oUrl.sUrlBase+"images/yanhua/swf/king.swf",imageUrl:oPageConfig.oUrl.sUrlBase+"images/yanhua/image/creator.png",iconUrl:oPageConfig.oUrl.sUrlBase+"images/yanhua/icon/creator.png",pos:"创世神",intPos:9}],$giftLayer:null,init:function(i){return oPageConfig.oRoom.permission.firework&&oPageConfig.firework?(this.$giftLayer=i,this.view(),this.bindEvent(),this.listenYPEvent(),this.listenSocketEvent(),void this.fChangeGiftType()):!1},view:function(){var e=this;e._ui.$body=$("body"),e._ui.$room_fun_area_right=$(".js-room-fun-area-right");var t='<li>                    <a href="javascript:;" class="js-fire-gift" style="display:none;">                      <img alt="">                    </a>                  </li>';i.fAppendGiftItem(t),e._ui.$fire_gift=e.$giftLayer.find(".js-fire-gift"),t='<div class="gifts-hover-ibox yanhua-hover-ibox js-fire-gift-info clearfix" style="display:none;">                <i class="arrow"></i>                <div class="left-area">                  <img src="'+oPageConfig.oUrl.sUrlBase+'i/new-yanhua.gif" alt="">                </div>                <div class="right-area">                  <div class="sub-top">                    <span class="dv name">爆炸吧！烟花！</span>                    <a class="a" href="/news/2016/05/17/1006.html" target="_blank">了解详情»</a>                  </div>                  <div class="note-title js-fire-gift-info-content"></div>                  <div class="yanhua-title">                    <p>1、全站广播通知（白金及以上）</p>                    <p>2、直播间横幅常显5分钟，倒计时5秒boom~</p>                    <p>3、超炫的全屏特效，这个直播间被您承包了！</p>                  </div>                </div>              </div>',e._ui.$fire_gift_info=$(t),e._ui.$room_fun_area_right.append(e._ui.$fire_gift_info);var a="";yp.each(e.aFireGiftInfo,function(i){i.fireGold&&(a='<li class="clearfix js-fire-gift-buy-item" data-level="'+i.level+'" data-pos="'+i.intPos+'">                          <a href="javascript:;">                            <i class="radio disable-icon js-fire-gift-buy-radio"></i>                            <p class="name">'+i.name+'</p>                            <p class="num">'+i.fireGold+'金币</p>                          </a>                          <div class="title-area">                            <i class="arrow"></i>                            <div class="tit"><i class="icon dv"></i>'+i.info+"</div>                          </div>                        </li>"+a)}),t='<div class="common-ibox message-tit-ibox new-yanhua-ibox" id="js-fire-gift-buy" style="display:none;">                <div class="content">                  <div class="hd">                    陪你看烟花                    <a href="javascript" class="close js-close"></a>                  </div>                  <div class="bd">                    <ul>                      <li class="clearfix js-fire-gift-buy-item" data-fire="free" data-pos="8">                        <a href="javascript:;">                          <i class="radio disable-icon js-fire-gift-buy-radio"></i>                          <p class="name">神/创世神烟花<span class="js-yanhua-completed" style="display:none;">已完成</span></p>                          <p class="num">7日等级特权</p>                        </a>                        <div class="title-area">                          <i class="arrow"></i>                          <div class="tit js-fire-gift-buy-info"><i class="icon dv"></i>房间人数达标最多可向在线用户发放500万金币，5000万战旗币</div>                        </div>                      </li>'+a+'</ul>                    <div class="btn-area textC">                      <a href="javascript:;" class="ibox-shut-down-btn js-close">取消</a>                      <a href="javascript:;" class="ibox-define-btn js-buy-btn">确定</a>                    </div>                  </div>                </div>              </div>',e._ui.$fire_gift_buy=$(t),e._ui.$body.append(e._ui.$fire_gift_buy)},bindEvent:function(){var i=this,e=i._ui;e.$fire_gift.on("mouseenter",function(e){i.fFireGiftInfoShow()}).on("mouseleave",function(e){i.fFireGiftInfoHide()}),e.$fire_gift_info.on("mouseenter",function(e){i.fFireGiftInfoShow()}).on("mouseleave",function(e){i.fFireGiftInfoHide()}),e.$fire_gift.on("click",function(e){i.fFireGiftUse(),i.fFireGiftInfoHideNow()}),e.$fire_gift_buy.on("click",".js-fire-gift-buy-item",function(i){var t=$(this),a=t.find(".js-fire-gift-buy-radio");a.hasClass("checked")||a.hasClass("disable-icon")||(e.$fire_gift_buy.find(".js-fire-gift-buy-item.active").find(".js-fire-gift-buy-radio").removeClass("checked"),e.$fire_gift_buy.find(".js-fire-gift-buy-item.active").removeClass("active"),a.addClass("checked"),t.addClass("active"))}).on("click",".js-close",function(i){i.preventDefault(),e.$fire_gift_buy.hide()}).on("click",".js-buy-btn",function(t){t.preventDefault(),i.fDoBuyFire(),e.$fire_gift_buy.hide()})},listenYPEvent:function(){var i=this;i._ui;yp.sub("page/site/level/update/next",function(e,t){i.fChangeGiftType()}),yp.sub("page/logout/done",function(e,t){i.fChangeGiftType()}),yp.sub("page/login/done",function(e,t){i.fChangeGiftType()}),window.SilvercallJS=function(i){setTimeout(function(){yp.pub("page/yanhua/swf/ready",{targetId:i})},0)},yp.sub("page/yanhua/swf/ready",function(e,t){var a=$("#swf-panel-"+t.targetId).data("uid");$("#swf-item-"+t.targetId)[0].SilvercallAS&&$("#swf-item-"+t.targetId)[0].SilvercallAS(1),i.oFwHash[a]="ready",setTimeout(function(){$("#swf-item-"+t.targetId)[0].SilvercallAS&&$("#swf-item-"+t.targetId)[0].SilvercallAS(2),$("#swf-panel-"+t.targetId).remove(),i.fDoFaterFw(a),$(".yanhua-swf-ibox .yanhua-swf-layer").length||$(".yanhua-swf-ibox").remove()},3e4)})},listenSocketEvent:function(){var i=this;i._ui;$.topic("msgc/usefire").sub(function(i){0!=i.code&&alert('<div class="info">            <div class="no-subscription-list">              <i class="qn-logo cry-logo dv"></i>              <p class="text dv" style="text-align:left;">'+i.debug+"</p>            </div>          </div>","","",{width:370})}),$.topic("msgc/firebro").sub(function(e){return oPageConfig.oRoom.id!=e.roomid?!1:(oPageConfig.oLoginInfo&&oPageConfig.oLoginInfo.uid==e.uid&&8<=e.bp&&(oPageConfig.oLoginInfo.slevel.opp=2),void i.fFireGiftSlide(e))}),$.topic("msgc/Level.FwGet").sub(function(e){i.oFwHash[e.data.uid]&&"finished"==i.oFwHash[e.data.uid]?i.fShowFwGet(e):i.oFwGetHash[e.data.uid]=e}),$.topic("msgc/Level.FwList").sub(function(e){i.oFwListHash[e.data.uid]=e,"hidden"==yp.documentVisible?i.fDoFaterFw(e.data.uid):i.fShowFireWorks(e);var t=$('.yanhua-gifts-ibox[data-owner="'+e.data.uid+'"]');i.fFireGiftTimeClear(t)}),$.topic("msgc/togglesize").sub(function(e){i.fFireWinnerSize(e.esc)})},oFwGetHash:{},oFwListHash:{},oFwHash:{},fDoFaterFw:function(i){var e=this;e.oFwGetHash[i]&&(e.fShowFwGet(e.oFwGetHash[i]),e.oFwGetHash[i]=null),e.oFwListHash[i]&&(e.fShowWinner(e.oFwListHash[i]),e.oFwListHash[i]=null),e.oFwHash[i]="finished"},fShowFwGet:function(i){var e=this,t=i.data.gold,a=i.data.coin;t?(alert("恭喜您通过"+i.data.user+"的"+e.aFireGiftInfo[i.data.bp].name+"获得 "+t+" 金币。"),yp.pub("page/rich/update",{num:t,type:"gold"})):(alert("恭喜您通过"+i.data.user+"的"+e.aFireGiftInfo[i.data.bp].name+"获得 "+a+" 战旗币。"),yp.pub("page/rich/update",{num:a,type:"coin"}))},fChangeGiftType:function(){var i=this,e=i._ui;oPageConfig.oLoginInfo?oPageConfig.oLoginInfo.slevel.pos:0;e.$fire_gift.show(),e.$fire_gift.find("img").attr("src",oPageConfig.oUrl.sUrlBase+"images/yanhua/icon/yanhua.png")},fFireGiftUse:function(){var i=this,e=i._ui;if(!oPageConfig.oLoginInfo)return yp.pub("page/login"),!1;if(2>oPageConfig.oLoginInfo.slevel.pos)return!1;e.$fire_gift_buy.find(".js-fire-gift-buy-item").removeClass("active"),e.$fire_gift_buy.find(".js-fire-gift-buy-item .js-fire-gift-buy-radio").removeClass("disable-icon").removeClass("checked");var t;yp.each(e.$fire_gift_buy.find(".js-fire-gift-buy-item"),function(e,a){t=$(e),"free"==t.data("fire")?8<=oPageConfig.oLoginInfo.slevel.pos?(t.find(".js-fire-gift-buy-radio").toggleClass("disable-icon",1!=oPageConfig.oLoginInfo.slevel.opp),t.find(".js-fire-gift-buy-info").html('<i class="icon dv"></i>'+i.aFireGiftInfo[oPageConfig.oLoginInfo.slevel.pos].info),t.find(".js-fire-gift-buy-radio").toggleClass("completed",1!=oPageConfig.oLoginInfo.slevel.opp),t.find(".js-yanhua-completed").toggle(1!=oPageConfig.oLoginInfo.slevel.opp)):(t.find(".js-fire-gift-buy-radio").addClass("disable-icon"),t.find(".js-fire-gift-buy-radio").removeClass("completed"),t.find(".js-fire-gift-buy-info").html(""),t.find(".js-yanhua-completed").hide()):t.find(".js-fire-gift-buy-radio").toggleClass("disable-icon",oPageConfig.oLoginInfo.slevel.level<t.data("level"))}),e.$fire_gift_buy.show()},fFireGiftInfoShow:function(){var i=this,e=i._ui;if(e.$fire_gift.data("timeout"))return clearTimeout(e.$fire_gift.data("timeout")),e.$fire_gift.data("timeout",0),!1;e.$fire_gift_info.show();var t=e.$fire_gift.offset(),a=e.$room_fun_area_right.offset(),o=t.left-a.left-(e.$fire_gift_info.outerWidth()-e.$fire_gift.outerWidth())/2,n=t.top-a.top-e.$fire_gift_info.outerHeight()-10;e.$fire_gift_info.css({left:o,top:n});var s="";if(!oPageConfig.oLoginInfo||2>oPageConfig.oLoginInfo.slevel.pos)s="<p>您尚未达到白银等级，无法使用烟花！</p>";else{var f="白银";31<=oPageConfig.oLoginInfo.slevel.level?f="王者":26<=oPageConfig.oLoginInfo.slevel.level?f="大师":21<=oPageConfig.oLoginInfo.slevel.level?f="钻石":16<=oPageConfig.oLoginInfo.slevel.level?f="白金":11<=oPageConfig.oLoginInfo.slevel.level&&(f="黄金"),s="您已经达到"+f+"，可以使用"+f+"以下的所有烟花</p>"}e.$fire_gift_info.find(".js-fire-gift-info-content").html(s)},fFireGiftInfoHide:function(){var i=this,e=i._ui,t=setTimeout(function(){i.fFireGiftInfoHideNow()},300);e.$fire_gift.data("timeout",t)},fFireGiftInfoHideNow:function(){var i=this,e=i._ui;return e.$fire_gift_info?(e.$fire_gift_info.hide(),void(e.$fire_gift.data("timeout")&&(clearTimeout(e.$fire_gift.data("timeout")),e.$fire_gift.data("timeout",0)))):!1},fDoBuyFire:function(){var e,t,a=this,o=a._ui,n=o.$fire_gift_buy.find(".js-fire-gift-buy-item");if(yp.each(n,function(i){return t=$(i),t.find(".js-fire-gift-buy-radio").hasClass("checked")?(e=t.data("pos"),!1):void 0}),!e)return alert("请选择要使用的烟花类型"),!1;var s=7>=e?e:oPageConfig.oLoginInfo.slevel.pos,f=7>=s?"您确定要花费"+a.aFireGiftInfo[s].fireGold+"金币，在当前房间放"+a.aFireGiftInfo[s].name+"吗？":"您确定要在当前房间放"+a.aFireGiftInfo[s].name+"吗？";confirm(f,function(){if(7>=s){+a.aFireGiftInfo[s].fireGold;if(+a.aFireGiftInfo[s].fireGold>i.oRich.fReturnRich("gold"))return alert("金币不足，请充值"),!1;yp.pub("page/rich/update",{num:0-+a.aFireGiftInfo[s].fireGold,type:"gold"})}a.ajax_socket("usefire",{bp:+s})},"",{width:345})},fFireGiftSlide:function(e){var t=this,a=(t._ui,""),o=["","","","","","","","first-yanhua-ibox","second-yanhua-ibox","second-yanhua-ibox"];if($('.js-slide-gift-show[data-owner="'+e.uid+'"]').length)return!1;a='<div class="yanhua-gifts-ibox '+o[e.bp]+' js-slide-gift-show" data-owner="'+e.uid+'">                <div class="send-gifts-inner">                  <p class="name">'+e.name+'</p>                  <div class="send-bottom">                    <p>送出的<span>'+t.aFireGiftInfo[e.bp].name+'</span>将在<span class="num js-time-cutdown">300</span>秒后点燃</p>                  </div>                  <img src="'+t.aFireGiftInfo[e.bp].imageUrl+'" alt="" class="gifts-icon">                </div>              </div>';var n=$(a),s=i.fGiftSpecialCss(!0);i.$specialContain.append(n),n.css({left:i.$specialContain.width(),top:s}).show();n.find(".name").width();t.fFireGiftTimeCutdown(n,e.lefttime),yp.pub("page/fire/time/start",{uid:e.uid}),n.animate({left:0},300)},fFireGiftTimeCutdown:function(i,e){var t,a=this;e>0?(t=setTimeout(function(){e--,i.find(".js-time-cutdown").html(e),a.fFireGiftTimeCutdown(i,e)},1e3),i.data("timeout",t)):a.fFireGiftTimeClear(i)},fFireGiftTimeClear:function(e){e.data("timeout")&&clearTimeout(e.data("timeout")),yp.pub("page/fire/time/end",{uid:e.data("owner")}),e.remove(),i.fGiftSpecialCss(!1)},$winner_list_panel:null,fShowWinner:function(e){var t=this,a=e.data.list,o=e.data.bp,n=e.data.total,s=i.$specialContain.closest(".liveDialog-box"),f="",l="";if(!a.length)return!1;var r=s.find(".js-winner-list-panel");r.length||(s.append('<div class="yanhua-show js-winner-list-panel"></div>'),t.$winner_list_panel=r=s.find(".js-winner-list-panel"),r.on("click",".js-close",function(i){i.preventDefault();var e=$(this).closest(".js-yanhua-ibox-item");e.remove(),0==r.find(".js-yanhua-ibox-item").length&&(r.remove(),t.$winner_list_panel=null)})),yp.each(a,function(i,e){f+='<li class="clearfix">                      <div class="left-area">'+i[0]+'</div>                      <div class="right-area">获得<span>'+i[1]+"</span>金币</div>                    </li>"}),l='<div class="yanhua-show-ibox js-yanhua-ibox-item">                <div class="hd">                  <p>                    <span class="name dv">'+e.data.nickname+'</span>                    <span class="dv">的</span>                    <span class="dv">'+t.aFireGiftInfo[o].name+'</span>                  </p>                  <p>                    <span class="dv">总计</span>                    <span class="dv">'+n+'</span>                    <span class="dv">人获奖</span>                  </p>                  <a href="javascript:;" class="close js-close"></a>                </div>                <div class="bd">                  <ul class="clearfix">'+f+"</ul>                </div>              </div>",r.append(l)},fFireWinnerSize:function(){var e=this;i.$specialContain.closest(".liveDialog-box");return e.$winner_list_panel?void 0:!1},fShowFireWorks:function(i){var e=this,t=i.data.bp,a=$.now();$(".yanhua-swf-ibox").length||$("#js-flash-panel").append('<div class="yanhua-swf-ibox"></div>');var o=$("#BFPlayerID"),n=o.outerWidth(),s=o.outerHeight(),f={marginLeft:(0-n)/2,marginTop:(0-s)/2,width:n,height:s,top:"50%",left:"50%",position:"absolute",zIndex:1},l=$('<div class="yanhua-swf-layer" id="swf-panel-'+a+'" data-uid="'+i.data.uid+'"><div id="swf-layer-'+a+'"></div></div>').css({position:"absolute",width:n,height:s,top:0,left:0});$(".yanhua-swf-ibox").css(f).append(l),swfobject.embedSWF(e.aFireGiftInfo[t].flashUrl+"?targetId="+a,"swf-layer-"+a,"100%","100%","11.0.0","",{},{wmode:"transparent",allowScriptAccess:"always"},{id:"swf-item-"+a}),e.oFwHash[i.data.uid]="loading"},ajax_socket:function(i,e){return e=e||{},yp.ajax(i,{type:"socket",data:e})}};"undefined"!=typeof module?module.exports=i:"function"==typeof define&&define.amd?define(function(){return i}):window.oGift=i}();