+function(){oPageConfig.oTask={regist:{type:"regist",default_txt:"注册后，战旗将给您账户送上500战旗币，快来注册吧~",btn_default_txt:"500战旗币",complete_txt:"注册后，战旗将给您账户送上500战旗币，快来注册吧~",btn_complete_txt:"点击领取",jump_url:"",taskTitle:"注册",hide:1,next:"avatar"},phone:{type:"phone",default_txt:"为了保障您的账户安全，您可以进入个人中心，在“安全绑定”中绑定手机后即可送您2000战旗币哦~",btn_default_txt:"2000战旗币",complete_txt:"为了保障您的账户安全，您可以进入个人中心，在“安全绑定”中绑定手机后即可送您2000战旗币哦~",btn_complete_txt:"点击领取",jump_url:"/user/info",taskTitle:"绑定手机号",hide:1,prev:"avatar"},avatar:{type:"avatar",default_txt:"进入个人中心上传头像将获得100战旗币哦~做一个有头有脸的大人物吧~",btn_default_txt:"100战旗币",complete_txt:"进入个人中心上传头像将获得100战旗币哦~做一个有头有脸的大人物吧~",btn_complete_txt:"点击领取",jump_url:"/user/info",taskTitle:"有头有脸",hide:1,next:"phone",prev:"regist"},share:{type:"share",default_txt:"分享直播间给好友，每邀请一位新用户并观看直播5分钟即可获得10金币奖励(每天最多邀请50位)。前三位用户每位奖励100金币哦。",btn_default_txt:"10金币",complete_txt:"分享直播间给好友，每邀请一位新用户并观看直播5分钟即可获得10金币奖励(每天最多邀请50位)。前三位用户每位奖励100金币哦。",btn_complete_txt:"点击领取",jump_url:"",taskTitle:"分享直播间",hide:0},slotmachine:{type:"slotmachine",default_txt:"每天观看5，30，60分钟可分别获得一次抽奖机会。最高金额2200金币。",btn_default_txt:"抽金币",complete_txt:"每天观看5，30，60分钟可分别获得一次抽奖机会。最高金额2200金币。",btn_complete_txt:"",jump_url:"",taskTitle:"老虎机",hide:1},code:{type:"code",default_txt:"一串神秘的代码。“码”上来领！",btn_default_txt:"去领取",complete_txt:"一串神秘的代码。“码”上来领！",btn_complete_txt:"去领取",jump_url:"",taskTitle:"“码”上激活",hide:0}};var e={_ui:{},init:function(){this.view(),this.bindEvent(),this.listenYpEvent(),oPageConfig.oLoginInfo&&this.fTaskCompleteStatus(),this.fWhenShareEnter(),a.init(),t.init()},view:function(){var e=this._ui,a="";e.$taskPanel=$("#js-room-task-panel"),e.$js_task_panel_item=e.$taskPanel.find(".js-task-panel-item"),e.$js_webgame_task_list_panel=e.$taskPanel.find(".js-webgame-task-list-panel"),e.$js_daily_task_list_panel=e.$taskPanel.find(".js-daily-task-list-panel"),e.$task_info_tips=$("#js-task-info-tips"),e.$webgame_count=e.$taskPanel.find(".js-webgame-count"),a='<li>                <a href="javascript:;">                  <div class="title-area js-room-task-complete-cnt">9+</div>                  <img src="'+oPageConfig.oUrl.sUrlBase+'images/index/rw.jpg" alt="">                </a>              </li>',e.$taskBtn=yp.module.fCallFun("oBaseUI","fRegistRoomFun",[{sHtml:a,key:"task",weight:1}]),e.$completeCnt=e.$taskBtn.find(".js-room-task-complete-cnt")},bindEvent:function(){var e=this,a=e._ui;a.$taskBtn.on("click",function(a){a.preventDefault(),yp.pub("page/task/panel/show"),e.fGetTaskList()}),a.$taskPanel.on("click",".js-close",function(e){e.preventDefault(),yp.pub("page/task/panel/hide")}),a.$taskPanel.on("click",".js-back",function(e){e.preventDefault(),yp.pub("page/task/panel/change",{panel:"list"})}),a.$taskPanel.on("mouseenter",".task-item",function(e){var t,o,n=$(this),i=n.offset(),s=a.$taskPanel.find('.js-task-panel-item[data-panel="list"]').offset(),c=n.data("type"),l={position:"absolute",margin:0};o=oPageConfig.oTask[c].taskTitle,t=n.hasClass("done")&&!n.hasClass("active")?yp.format(oPageConfig.oTask[c].complete_txt,{coin:"share"==c?n.data("gold"):n.data("coin")}):oPageConfig.oTask[c].default_txt,a.$task_info_tips.find(".js-task-info-tips-title").html(o),a.$task_info_tips.find(".js-task-info-tips-desc").html(t),a.$task_info_tips.show(),l.top=i.top-s.top-a.$task_info_tips.outerHeight()-10,l.left=i.left-s.left-4+(n.width()-a.$task_info_tips.outerWidth())/2,a.$task_info_tips.css(l),n.hasClass("active")||n.addClass("hover")}).on("mouseleave",".task-item",function(e){$(this).removeClass("hover"),a.$task_info_tips.hide()}),a.$taskPanel.on("click",".js-refresh",function(a){a.preventDefault(),e.fTaskCompleteStatus(),e.taskListLoaded=!1,e.fGetTaskList()}),this.fTaskClick(),this.fTaskReceive(),this.fWebGameEvent()},fTaskClick:function(){var e=this,a=e._ui;a.$taskPanel.on("click",".task-click",function(e){e.preventDefault();var a=$(this),t=a.closest(".task-item").data("type");switch(yp.pub("page/task/do",{type:t}),t){case"regist":oPageConfig.oLoginInfo||yp.pub("page/regist"),yp.pub("page/task/panel/hide");break;case"avatar":window.open(oPageConfig.oTask[t].jump_url),yp.pub("page/task/panel/hide");break;case"share":oPageConfig.oLoginInfo?setTimeout(function(){yp.pub("page/room/share")},0):yp.pub("page/login"),yp.pub("page/task/panel/hide");break;case"phone":window.open(oPageConfig.oTask[t].jump_url),yp.pub("page/task/panel/hide");break;case"slotmachine":oPageConfig.oLoginInfo?(yp.pub("page/task/panel/change",{panel:"slotmachine"}),yp.pub("page/slotmachine/show")):(yp.pub("page/login"),yp.pub("page/task/panel/hide"));break;case"code":yp.pub("page/task/panel/hide"),oPageConfig.oLoginInfo?yp.pub("page/activationCode/show"):(yp.pub("page/login"),yp.pub("page/activationCode/hide"))}})},fTaskReceive:function(){var e=this,a=e._ui;a.$taskPanel.on("click",".task-receive",function(a){if(a.preventDefault(),!oPageConfig.oLoginInfo)return yp.pub("page/login"),!1;var t=$(this),o=t.closest(".task-item"),n=o.data("type");yp.pub("page/task/receive",{type:n}),t.data("ajaxing")||(t.data("ajaxing",!0),yp.ajax(oPageConfig.oUrl.sTaskReceiveUrl,{data:{type:n},type:"post",dataType:"json"}).done(function(a){if(0==a.code){var t=o.data("coin"),i=o.data("gold");"share"==n?e.fSetTaskStatus(o,0):e.fSetTaskStatus(o,2),i>0&&(yp.pub("page/rich/update",{num:i,type:"gold"}),yp.successNotify("领取成功，获得"+i+"金币")),t>0&&(yp.pub("page/rich/update",{num:t,type:"coin"}),yp.successNotify("领取成功，获得"+t+"战旗币")),e.fCheckTaskCnt()}else 100==a.code?yp.pub("page/alert/bindphone"):102==a.code?(yp.pub("page/site/phone/check",{bCountrySelect:!1,bPhoneInput:!1,submitUrl:"/api/user/user.mobile_voice"}),yp.pub("page/task/panel/hide")):a.message&&yp.errorNotify(a.message)}).always(function(){t.data("ajaxing",!1)}))})},listenYpEvent:function(){var e=this,a=e._ui;yp.sub("page/logout/done",function(){e.fTaskReset(),yp.pub("page/task/panel/hide")}),yp.sub("page/login/done",function(){e.fTaskCompleteStatus(),e.taskListLoaded=!1,e.oTokenHash.value="",e.oTokenHash.time=0}),yp.sub("page/regist/done",function(){e.fTaskCompleteStatus()}),yp.sub("page/task/extracnt",function(a,t){e.extraCnt[t.type]=t.cnt,e.fCheckTaskCnt()}),yp.sub("page/task/panel/show",function(){a.$taskPanel.show(),yp.pub("page/task/panel/change",{panel:"list"})}),yp.sub("page/task/panel/hide",function(){a.$taskPanel.hide()}),yp.sub("page/task/panel/change",function(e,t){switch(a.$taskPanel.removeClass("slotMachine-ibox"),a.$js_task_panel_item.hide(),a.$taskPanel.find('.js-task-panel-item[data-panel="'+t.panel+'"]').show(),t.panel){case"slotmachine":a.$taskPanel.addClass("slotMachine-ibox")}})},fTaskCompleteStatus:function(){var e=this,a=e._ui;return!oPageConfig.oLoginInfo||a.$js_daily_task_list_panel.find(".js-loading").is(":visible")?!1:(a.$js_daily_task_list_panel.find(".js-loading").show(),a.$js_daily_task_list_panel.find(".js-daily-task-list").hide(),void yp.ajax("/api/actives/task/info.status",{dataType:"json",type:"post"}).done(function(a){0==a.code?e.fShowTask(a.data):a.message&&yp.errorNotify(a.message)}).always(function(){a.$js_daily_task_list_panel.find(".js-loading").hide(),a.$js_daily_task_list_panel.find(".js-daily-task-list").show()}))},extraCnt:{},completeCnt:0,fCompleteCntChange:function(e,a){var t=this,o=t._ui,n=t.completeCnt;switch(e){case"update":n=a;break;case"add":n+=a;break;case"cut":n-=a}n=Math.max(n,0),t.completeCnt=n,n>0?o.$completeCnt.html(n).show():(n=0,o.$completeCnt.html(n).hide())},fCheckTaskCnt:function(){var e=this,a=e._ui,t=0;if(oPageConfig.oLoginInfo){yp.each(a.$taskPanel.find(".task-item"),function(e){1==$(e).data("status")&&$(e).hasClass("done")&&t++});var o=0;yp.each(e.extraCnt,function(e,a){"slotmachine"!=a&&(o+=+e)}),t+=o}t>0?a.$completeCnt.html(t).show():a.$completeCnt.html(t).hide()},fShowTask:function(e){var a=this,t=a._ui;t.$taskPanel.find(".task-item").not('[data-type="slotmachine"]').not('[data-type="code"]').addClass("hidden"),yp.each(e,function(e){var a=t.$taskPanel.find('.task-item[data-type="'+e.type+'"]');a.length&&(a.removeClass("hidden"),a.data("coin",e.coin||0),a.data("gold",e.gold||0),a.data("status",e.status))}),yp.each(t.$taskPanel.find(".task-item"),function(e){var t=$(e),o=t.data("type");"avatar"!=o&&"phone"!=o&&"slotmachine"!=o&&"code"!=o&&a.fSetTaskStatus(t,t.data("status"))}),a.fCheckTaskCnt()},fWhenShareEnter:function(){var e=getQueryString("_p");e&&!isNaN(e)&&yp.ajax("/api/public/promote.visit",{type:"post",data:{pid:e}})},fTaskReset:function(){var e=this,a=e._ui;yp.each(a.$taskPanel.find(".task-item"),function(a){var t=$(a);("slotmachine"!=t.data("type")||"code"!=t.data("type"))&&(e.fSetTaskStatus(t,0),("avatar"==t.data("type")||"phone"==t.data("type"))&&t.hide())}),e.extraCnt={},e.fCheckTaskCnt()},fSetTaskStatus:function(e,a){var t=this,o=e.data("type");if(!e.length)return!1;switch(e.removeClass("done").removeClass("active"),e.data("status",a),+a){case 0:e.find(".task-btn").removeClass("task-receive").addClass("task-click").find(".task-txt").html(oPageConfig.oTask[o].btn_default_txt),e.find(".task-desc").addClass("task-click"),e.data("coin",0),e.data("gold",0),("avatar"==o||"phone"==o||"appview"==o)&&e.hide();break;case 1:e.addClass("done"),e.find(".task-btn").removeClass("task-click").addClass("task-receive").find(".task-txt").html("领取"),e.find(".task-desc").removeClass("task-click");break;case 2:"share"==o?t.fSetTaskStatus(e,0):(e.addClass("done").addClass("active"),e.find(".task-btn").removeClass("task-click").removeClass("task-receive").find(".task-txt").html("已领取"),e.find(".task-desc").removeClass("task-click"),("regist"==o||"avatar"==o||"app"==o)&&t.fShowNextTask(o))}2==a&&oPageConfig.oTask[o].hide?e.hide():e.show()},fShowNextTask:function(e){var a=this,t=a._ui,o=oPageConfig.oTask[e].next;if(!o)return!1;var n=t.$taskPanel.find('.task-item[data-type="'+o+'"]');n.length&&a.fSetTaskStatus(n,n.data("status"))},fWebGameEvent:function(){var e=this,a=e._ui;a.$js_webgame_task_list_panel.on("click",".js-receive-btn",function(a){a.preventDefault();var t=$(this),o=t.closest(".webgame-task-item").data("id");e.fWebGameTaskReceive(o)}),a.$js_webgame_task_list_panel.on("mouseenter",".webgame-task-item",function(t){var o,n,i=$(this),s=i.offset(),c=a.$taskPanel.find('.js-task-panel-item[data-panel="list"]').offset(),l=i.data("id"),d={position:"absolute",margin:0},p=void 0!=e.oGameTaskHash[l]?e.aGameTask[e.oGameTaskHash[l]]:"";return p?(n=p.content,o=e.fBuildTaskSubMissionHtml(p),a.$task_info_tips.find(".js-task-info-tips-title").html(n),a.$task_info_tips.find(".js-task-info-tips-desc").html(o),a.$task_info_tips.show(),d.top=s.top-c.top-a.$task_info_tips.outerHeight()-10,d.left=s.left-c.left-4+(i.width()-a.$task_info_tips.outerWidth())/2,a.$task_info_tips.css(d),void(i.hasClass("active")||i.addClass("hover"))):!1}).on("mouseleave",".webgame-task-item",function(e){$(this).removeClass("hover"),a.$task_info_tips.hide()})},fSetWebGameCount:function(e){var a=this,t=a._ui;oPageConfig.oLoginInfo||(e=0),t.$webgame_count.html(e).data("count",e).toggle(e>0),a.fCheckTaskCnt()},taskListLoaded:!1,fGetTaskList:function(){var e=this,a=e._ui;return e.taskListLoaded?!1:(a.$js_webgame_task_list_panel.find(".js-loading").show(),a.$js_webgame_task_list_panel.find(".js-webgame-mission-list").hide(),e.aGameTask=[],e.oGameTaskHash={},e.taskListLoaded=!0,void(oPageConfig.oLoginInfo?e.fGetToken().done(function(a){0==a.code?e.fSubmitTaskList(a.data):e.taskListLoaded=!1}).fail(function(){e.taskListLoaded=!1}):e.fSubmitTaskList()))},fSubmitTaskList:function(e){var a=this,t=a._ui,o="";e=e||{},o=oPageConfig.oLoginInfo?"https://2133.zhanqi.tv/index.php?r=zqAjaxTask/getLiveTaskByToken":"https://2133.zhanqi.tv/index.php?r=zqAjaxTask/getTaskData",yp.ajax(o,{type:"get",dataType:"jsonp",data:e}).done(function(e){if(0==e.code){a.aGameTask=e.data.taskList;var o=a.fBuildTaskHtml();t.$js_webgame_task_list_panel.find(".js-webgame-mission-list").html(o).show(),t.$js_webgame_task_list_panel.find(".js-loading").hide()}else a.taskListLoaded=!1}).fail(function(){a.taskListLoaded=!1})},aGameTask:[],oGameTaskHash:{},fBuildTaskHtml:function(){var e=this,a="";return yp.each(e.aGameTask,function(t,o){e.oGameTaskHash[t.id]=o,3>=o&&(a+=e.fBuildTaskItemHtml(t))}),a},fBuildTaskItemHtml:function(e){var a="",t=0,o=0,n=0,i=0,s=["立即开始","领取金币","已完成"],c=["webgame-task-item","webgame-task-item done","webgame-task-item done active"],l=["receive-btn","receive-btn js-receive-btn","receive-btn"];yp.each(e.subMission,function(e,a){t++,2==e.status?o++:1==e.status&&n++,1==e.status&&(i=1)}),t==o&&(i=2),e.missionStatus=i;var d=e.gameName,p=d.length;return p>3&&(d=4==p||5==p?d.replace(/(.{2})/,"$1<p></p>"):d.replace(/(.{3})/g,"$1<p></p>")),2==i?missionBtnHtml='<a class="'+l[i]+"\" href=\"/user/wallet/log.gold\" target=\"_blank\" onclick=\"_hmt.push(['_trackEvent', '2133webgameJump', 'room_task_panel_task_complete', 'task_"+e.id+'\'])"><i class="crown"></i><div class="name"><p>'+d+"</p></div><span>已完成</span></a>":1==i?missionBtnHtml='<a class="'+l[i]+"\" href=\"javascript:;\" onclick=\"_hmt.push(['_trackEvent', '2133webgameJump', 'room_task_panel_task_receive', 'task_"+e.id+'\'])"><i class="crown"></i><div class="name"><p>'+d+"</p></div><span>"+s[i]+"</span></a>":missionBtnHtml='<a class="'+l[i]+'" href="'+e.serverUrl+"\" target=\"_blank\" onclick=\"_hmt.push(['_trackEvent', '2133webgameJump', 'room_task_panel_task_play', 'task_"+e.id+'\'])"><i class="crown"></i><div class="name"><p>'+d+"</p></div><span>"+s[i]+"</span></a>",a+='<li class="yeyou-rw page-game rw-jb '+c[i]+'" data-id="'+e.id+'">'+missionBtnHtml+"</li>"},fSetWebGameTaskStatus:function(e,a,t,o){var n=this,i=n._ui,s=void 0!=n.oGameTaskHash[o]?n.aGameTask[n.oGameTaskHash[o]]:"";return s?(yp.each(s.subMission,function(t){t.status==e&&(t.status=a)}),void(i.$js_webgame_task_list_panel.find('.webgame-task-item[data-id="'+s.id+'"]').length&&i.$js_webgame_task_list_panel.find('.webgame-task-item[data-id="'+s.id+'"]').replaceWith(n.fBuildTaskItemHtml(s)))):!1},fBuildTaskSubMissionHtml:function(e){var a="",t="",o=["未完成","未领取","已完成"],n=["sub-not","sub-not","sub-done"];return yp.each(e.subMission,function(e,a){t+='<tr>                      <td class="num" width="15">'+(a+1)+'.</td>                      <td class="">'+e.content+'</td>                      <td class="money textR" width="60">                        <span>'+e.rewardCnt+'</span>金币                      </td>                      <td class="status textR" width="50">                        <span href="javascript:;" class="'+n[e.status]+'">'+o[e.status]+"</span>                      </td>                    </tr>"}),a='<div class="nr-rw-ibox">                  <div class="nr-bd">                    <table width="100%">                      <tbody>'+t+'</tbody>                    </table>                  </div>                  <div class="nr-ft" style="width: 215px;">                    任务结束时间：<span>'+fDateFormat("yyyy-MM-dd hh:mm:ss",1e3*e.endTime)+"</span>                  </div>                </div>"},fWebGameTaskReceive:function(e){var a=this,t=a._ui,a=this,o=t.$js_webgame_task_list_panel.find('.webgame-task-item[data-id="'+e+'"]').find(".js-receive-btn");return o.data("ajaxing")||!oPageConfig.oLoginInfo?!1:oPageConfig.oLoginInfo.bindEmail&&oPageConfig.oLoginInfo.bindMobile?(o.data("ajaxing",!0),void a.fGetToken().done(function(t){0==t.code?(t.data.id=e,yp.ajax("https://2133.zhanqi.tv/index.php?r=zqAjaxTask/getRewardOne",{type:"get",dataType:"jsonp",data:t.data}).done(function(t){0==t.code?(a.fWebGameTaskReceiveResult(0,t.data.rewardCnt),yp.pub("page/rich/update",{num:t.data.rewardCnt,type:"gold"}),a.fSetWebGameTaskStatus(1,2,1,e)):(o.data("ajaxing",!1),a.fWebGameTaskReceiveResult(1,t.message,function(){a.fWebGameTaskReceive(e)}))}).fail(function(){o.data("ajaxing",!1),a.fWebGameTaskReceiveResult(1,"金币领取失败！<br />网络似乎不给力呢~",function(){a.fWebGameTaskReceive(e)})})):(o.data("ajaxing",!1),a.fWebGameTaskReceiveResult(1,"金币领取失败！<br />网络似乎不给力呢~",function(){a.fWebGameTaskReceive(e)}))}).fail(function(){o.data("ajaxing",!1),a.fWebGameTaskReceiveResult(1,"金币领取失败！<br />网络似乎不给力呢~",function(){a.fWebGameTaskReceive(e)})})):(alert("请先绑定手机和邮箱"),!1)},fWebGameTaskReceiveResult:function(e,a,t){var o=this;0==e?$.ibox({title:"领取成功",content:"恭喜您获得"+a+"金币",btns:[{name:"我知道了"},{name:"马上查看",callback:function(){window.open("/user/wallet/log.gold")}}]}):$.ibox({title:"领取失败",content:a,btns:[{name:"稍后再试"},{name:"重试",callback:function(){t&&t.call(o)}}]})},oTokenHash:{value:"",time:0},fGetToken:function(){var e,a=this,t=$.now();return a.oTokenHash.value&&6e5>t-a.oTokenHash.time?(e=$.Deferred(),e.resolve({code:0,data:a.oTokenHash.value})):e=yp.ajax(yp.format(oPageConfig.oUrl.sGetTokenUrl,{appid:"20150127001"}),{type:"get",dataType:"jsonp"}).done(function(e){0==e.code&&(a.oTokenHash.value=e.data,a.oTokenHash.time=$.now())}),e}},a={_ui:{},chance:0,maxChance:0,bBindPhone:!1,hasGot:!1,goldGot:0,curDrawGetGold:0,init:function(){this.view(),this.bindEvent(),this.listenYpEvent(),this.listenSocket(),this.fSetBdConfig(),oPageConfig.oLoginInfo&&this.fGetChance()},view:function(){var e=this._ui;e.$smallSlotPanel=$("#js-small-slot-panel"),e.$slotmachinePopPanel=$("#js-slotmachine-pop-panel")},bindEvent:function(){var e=this,a=e._ui;a.$slotmachinePopPanel.on("click",".js-slotmachine-pop-btn",function(a){a.preventDefault(),e.fDraw()}),a.$slotmachinePopPanel.on("click",".js-close",function(e){e.preventDefault(),a.$slotmachinePopPanel.hide(),yp.pub("page/task/panel/hide")})},listenYpEvent:function(){var e=this,a=e._ui;yp.sub("page/slotmachine/show",function(){return oPageConfig.oLoginInfo?(a.$slotmachinePopPanel.show(),e.bBindPhone?e.chance?a.$slotmachinePopPanel.find(".js-slotmachine-pop-chance").html("还有 "+e.chance+" 次机会哦").show():3==e.maxChance?a.$slotmachinePopPanel.find(".js-slotmachine-pop-chance").html("抱歉，今日摇奖机会已用完").show():a.$slotmachinePopPanel.find(".js-slotmachine-pop-chance").html("暂无机会，待会再来吧").show():a.$slotmachinePopPanel.find(".js-slotmachine-pop-chance").html("绑定手机100%中金币哦").show(),a.$slotmachinePopPanel.find(".js-slotmachine-pop-result").hide(),void e.fSlotmachineReset()):(yp.pub("page/login"),!1)}),yp.sub("page/logout/done",function(){e.fResetUser(),e.fSetBdConfig()}),yp.sub("page/login/done",function(){e.fGetChance()}),yp.sub("page/regist/done",function(){e.fGetChance()}),yp.sub("page/slotmachine/draw",function(a,t){e.fDrawAnimate(t.gold)}),yp.sub("page/geetest/loaded",function(){e.fShowDrawGeet()})},listenSocket:function(){},fDraw:function(){var e=this,a=e._ui;return a.$slotmachinePopPanel.find(".js-slotmachine-pop-btn").data("ajaxing")||!oPageConfig.oLoginInfo?!1:e.bBindPhone?e.chance?void(e.maxChance==e.chance?(e.bShowDrawGeet=!0,window.Geetest?e.oRobGeet||yp.pub("page/geetest/loaded"):yp.pub("page/geetest/load")):e.fDrawSubmit()):(3==e.maxChance?a.$slotmachinePopPanel.find(".js-slotmachine-pop-chance").html("抱歉，今日摇奖机会已用完"):a.$slotmachinePopPanel.find(".js-slotmachine-pop-chance").html("暂无机会，待会再来吧"),!1):(e.fShowMsgBox("toBindMobile"),!1)},fDrawSubmit:function(){var e=this,a=e._ui;if(!oPageConfig.oLoginInfo)return!1;a.$slotmachinePopPanel.find(".js-slotmachine-pop-btn").data("ajaxing",!0),a.$slotmachinePopPanel.find(".js-slotmachine-pop-chance").html("老虎机准备启动···");var t=yp.ajax("/api/actives/lottery/lottery.6",{data:{roomId:oPageConfig.oRoom.id},type:"get",dataType:"json"});e.fAfterDraw(t)},fAfterDraw:function(e){var a=this,t=a._ui;e.done(function(e){0==e.code&&e.data.unit&&!isNaN(e.data.unit)?(a.goldGot=e.data.unit,a.hasGot=!0,a.curDrawGetGold=e.data.unit,t.$slotmachinePopPanel.find(".js-slotmachine-pop-chance").html("摇奖中···"),yp.pub("page/slotmachine/draw",{gold:e.data.unit||0})):1011==e.code?(a.fShowMsgBox("toBindMobile"),t.$slotmachinePopPanel.find(".js-slotmachine-pop-chance").html("请绑定手机后，刷新重试"),a.fSlotmachineReset()):102==e.code?(yp.pub("page/site/phone/check",{bCountrySelect:!1,bPhoneInput:!1,submitUrl:oPageConfig.oUrl.sPhoneCheckSubmitUrl}),t.$slotmachinePopPanel.find(".js-slotmachine-pop-chance").html("请先进行用户认证"),a.fSlotmachineReset(),yp.pub("page/task/panel/hide")):1015==e.code?(t.$slotmachinePopPanel.find(".js-slotmachine-pop-chance").html("抱歉，今日摇奖机会已用完"),a.fSlotmachineReset()):1005==e.code?(t.$slotmachinePopPanel.find(".js-slotmachine-pop-chance").html("暂无机会，待会再来吧"),a.fSlotmachineReset()):(t.$slotmachinePopPanel.find(".js-slotmachine-pop-chance").html("阿噢~机器坏了~("+e.code+")"),a.fSlotmachineReset()),102!=e.code&&a.chance--,a.fSetSlotmachineChance()}).fail(function(){t.$slotmachinePopPanel.find(".js-slotmachine-pop-chance").html("阿噢~机器坏了~"),a.fSlotmachineReset()})},fDrawAnimate:function(e){var a,t=this,o=t._ui,n=o.$slotmachinePopPanel.find(".js-slotmachine-pop-num-area .js-item");if(e=e?""+e:"0",a=e.split(""),n.length>a.length)for(;a.length<n.length;)a.unshift("0");for(var i=5+Math.floor(3*Math.random()),s=510*i,c=5e3,l=0,d=n.length-1;d>=0;d--){var p=39,f={height:s+51,marginTop:-s+39,backgroundPosition:"0 -479px"};n.eq(d).css(f),0!=a[d]&&(p+=51*(a[d]-10)),n.eq(d).animate({marginTop:p-510},{duration:c,easing:"easeInOutCirc",complete:function(){l++,l==n.length&&(t.fShowDrawResult(e),t.fSetBdConfig(),o.$slotmachinePopPanel.find(".js-slotmachine-pop-btn").data("ajaxing",!1))}}),s+=510,c+=1200}},fSlotmachineReset:function(){var e=this,a=e._ui;a.$slotmachinePopPanel.find(".js-slotmachine-pop-num-area .js-item").each(function(){$(this).css({height:90,marginTop:0,backgroundPosition:"0 -440px"})}),a.$slotmachinePopPanel.find(".js-slotmachine-pop-btn").data("ajaxing",!1)},fShowDrawResult:function(e){var a=this,t=a._ui;t.$slotmachinePopPanel.find(".js-slotmachine-pop-chance").html("恭喜你，获得"+e+"金币！"),yp.pub("page/rich/update",{num:e,type:"gold"})},fShowMsgBox:function(e){var a,t=this,o=(t._ui,""),n="关闭";switch(e){case"inSelfRoom":o="不能在自己房间摇奖";break;case"toBindMobile":o="绑定手机后再摇奖,100%中金币！",n="去绑定",a=function(){window.open("/user/info")};break;case"noChance":o="抱歉，今日摇奖机会已用完";break;case"hasGot":o="你已在当前直播间摇奖，去其他直播间摇一摇吧！";break;case"toFollow":o="订阅当前主播才能摇奖哦！",n="订阅并摇奖",a=function(){yp.pub("page/follow",{flag:1,uid:oPageConfig.oRoom.uid,callback:function(e){0==e.code&&(oPageConfig.oViewer.isFollow=!0,t.fDrawSubmit())}})}}$.ibox({title:"提示",content:o,btns:[{name:n,callback:function(){a&&a.call(t)}}]})},fResetUser:function(){this.chance=0,this.maxChance=0,this.bBindPhone=!1,this.hasGot=!1,this.goldGot=0,this.fSlotmachineTimeReset(),this.fSetSlotmachineChance()},fSetBdConfig:function(){var e=this;e.hasGot&&e.goldGot?(bdConfigSlotmachine.bdDesc="我在#战旗直播#“"+oPageConfig.oRoom.nickname+"”的直播间玩老虎机获得"+e.goldGot+"金币，赶紧来试试吧！（分享自${from}）",bdConfigSlotmachine.bdText="我在#战旗直播#“"+oPageConfig.oRoom.nickname+"”的直播间玩老虎机获得"+e.goldGot+"金币，赶紧来试试吧！（分享自${from}）"):(bdConfigSlotmachine.bdDesc="我在#战旗直播#“"+oPageConfig.oRoom.nickname+"”的直播间观看游戏直播，同时还能玩老虎机100%中金币哦。快来看看吧！（分享自${from}）",bdConfigSlotmachine.bdText="我在#战旗直播#“"+oPageConfig.oRoom.nickname+"”的直播间观看游戏直播，同时还能玩老虎机100%中金币哦。快来看看吧！（分享自${from}）")},fSetSlotmachineChance:function(){var e=this,a=e._ui,t=0!=e.chance,o="3-0"==e.maxChance+"-"+e.chance,n={"0-0":["red-star","red-star","red-star"],"1-1":["gold-star","red-star","red-star"],"1-0":["grey-star","red-star","red-star"],"2-2":["gold-star","gold-star","red-star"],"2-1":["grey-star","gold-star","red-star"],"2-0":["grey-star","grey-star","red-star"],"3-3":["gold-star","gold-star","gold-star"],"3-2":["grey-star","gold-star","gold-star"],"3-1":["grey-star","grey-star","gold-star"],"3-0":["grey-star","grey-star","grey-star"]},i="";yp.each(n[e.maxChance+"-"+e.chance],function(e){i+='<i class="star '+e+'"></i>'}),o="3-0"==e.maxChance+"-"+e.chance,a.$smallSlotPanel.closest(".task-item").toggleClass("active",o).find(".task-btn").toggleClass("task-click",t).find(".js-slotmachine-star").html(i),oPageConfig.oLoginInfo&&0<e.chance?yp.pub("page/task/extracnt",{cnt:1,type:"slotmachine"}):yp.pub("page/task/extracnt",{cnt:0,type:"slotmachine"})},fGetChance:function(){var e=this;yp.ajax("/api/actives/lottery/info.6",{data:{roomId:oPageConfig.oRoom.id},type:"get",dataType:"json"}).done(function(a){var t=0;0==a.code&&(e.chance=a.data.chance||0,e.maxChance=a.data.totalChance||0,e.bBindPhone=a.data.bindMobile||!1,t=a.data.lefttime,e.hasGot=e.maxChance!=e.chance),3>e.maxChance&&(+t||(t=e.aChanceTime[e.maxChance+1]-e.aChanceTime[e.maxChance]),e.fSlotmachineTimeCutdown(t)),e.fSetSlotmachineChance(),e.fSetBdConfig()})},timeout:0,aChanceTime:[0,300,1800,3600],fSlotmachineTimeCutdown:function(e){var a=this;a._ui;if(0>=oPageConfig.oRoom.status)return a.fSlotmachineTimeReset(),!1;if(e>0)a.timeout=setTimeout(function(){e--,a.fSlotmachineTimeCutdown(e)},1e3);else{if(a.chance++,a.maxChance++,yp.pub("page/slotmachine/cntadd"),3>a.maxChance){var t=a.aChanceTime[a.maxChance+1]-a.aChanceTime[a.maxChance];a.fSlotmachineTimeCutdown(t)}else a.fSlotmachineTimeReset();a.fSetSlotmachineChance()}},fFillZero:function(e,a){return e="00000"+e,e.slice(-a)},fSlotmachineTimeReset:function(){var e=this;e._ui;e.timeout&&clearTimeout(e.timeout)},bShowDrawGeet:!1,oDrawGeet:null,drawPop:null,fShowDrawGeet:function(){var e=this,a=e._ui;return e.bShowDrawGeet?(e.oDrawGeet=new window.Geetest({gt:"19565ca5c1c44cd27dd44930982ffccd",product:"embed"}),e.drawPop=$.ibox({title:"请拖动下面的验证",content:'<form action="/api/actives/lottery/lottery.6?roomId='+oPageConfig.oRoom.id+'" method="post"><div style="width: 315px; height: 190px;" class="js-geetest-area"></div></form>',width:360}),e.oDrawGeet.appendTo(e.drawPop.dom.find(".js-geetest-area")),e.oDrawGeet.onSuccess(function(){var t=e.drawPop.dom.find("form").ajaxSubmit().ajax;a.$slotmachinePopPanel.find(".js-slotmachine-pop-btn").data("ajaxing",!0),a.$slotmachinePopPanel.find(".js-slotmachine-pop-chance").html("老虎机准备启动···"),e.fAfterDraw(t),e.fRemoveDrawGeet()}),void e.drawPop.dom.on("dom.destroy",function(){e.fDrawEnd()})):!1},fRemoveDrawGeet:function(){var e=this;return e.drawPop?(e.drawPop.close(),void(e.drawPop=null)):!1},fDrawEnd:function(){var e=this;e.bShowDrawGeet=!1,e.oDrawGeet=null}},t={_ui:{},chance:0,$panel:null,oCodeInfoArr:{code:[],tao:[]},oCodeInfoArrHash:{code:{},tao:{}},init:function(){this.view(),this.bindEvent(),this.listenYpEvent(),this.listenSocket(),oPageConfig.oLoginInfo&&this.fGetChance()},view:function(){var e=this;e.$panel=$("#js-activation-code-panel"),e._ui.$choose_panel=$("#js-activation-code-choose-panel"),e._ui.$btn=$("#js-small-code-btn"),e._ui.$code_list_page=$(".js-activation-code-list-page")},bindEvent:function(){var e=this;e._ui;yp.use("jCopy",function(){e.$panel.find("[data-clipboard-target]").jcopy()}),e.$panel.on("click",".js-show-code",function(a){a.preventDefault(),e.fLoadCodeNum($(this))}).on("click",".js-close",function(a){a.preventDefault(),e.fHidePanel()}),e._ui.$choose_panel.on("click",".js-close",function(a){a.preventDefault(),e._ui.$choose_panel.hide()}).on("click",".js-code-choose-item",function(a){a.preventDefault(),e._ui.$choose_panel.hide(),e.fLoadCodeInfo($(this))}).on("click",".js-show-tao-hao",function(a){a.preventDefault(),e._ui.$choose_panel.find(".js-show-tao-hao-area").hide(),e._ui.$choose_panel.find('.js-code-choose-list[data-type="tao"]').show(),e._ui.$choose_panel.find('.js-code-choose-list[data-type="code"]').hide(),e._ui.$choose_panel.find(".js-choose-panel-title").html("淘号")})},listenYpEvent:function(){var e=this;e._ui;yp.sub("page/login/done",function(){e.fGetChance()}),yp.sub("page/regist/done",function(){e.fGetChance()}),yp.sub("page/logout/done",function(){e.fHidePanel(),e.fSetChance()}),yp.sub("page/activationCode/show",function(){e.fShowPanel()}),yp.sub("page/activationCode/hide",function(){e.fHidePanel()})},listenSocket:function(){},fGetChance:function(){var e=this;yp.ajax("/api/actives/task/info.codechance",{data:{roomId:oPageConfig.oRoom.id},type:"post",dataType:"json"}).done(function(a){if(0==a.code){e.oCodeInfoArr={code:[],tao:[]},e.oCodeInfoArrHash={code:{},tao:{}},yp.each(a.data.cdk,function(a){e.oCodeInfoArrHash.code[a.id]=a,e.oCodeInfoArr.code.push(a)});var t=$.cookie("thid_cookie")||"",o=$.cookie("thv_cookie")||0,n=[],i=!1;t=t.split("."),yp.each(a.data.taoCdk,function(a){n.push(""+a.id),-1==$.inArray(""+a.id,t)&&(i=!0),e.oCodeInfoArrHash.tao[a.id]=a,e.oCodeInfoArr.tao.push(a)}),i&&(o=1);var s=new Date;s.setTime(s.getTime()+31536e6),$.cookie("thid_cookie",n.join("."),{expires:s,path:"/"}),$.cookie("thv_cookie",o,{expires:s,path:"/"}),e.chance=e.oCodeInfoArr.code.length?e.oCodeInfoArr.code.length:0}e.fSetChance()})},fSetChance:function(){var e=this,a=$.cookie("thv_cookie")||0,t=$.cookie("thid_cookie")||"";oPageConfig.oLoginInfo?(0<e.chance?(yp.pub("page/task/extracnt",{cnt:e.chance,type:"code"}),e._ui.$btn.find(".js-code-chance").remove(),e._ui.$btn.append('<i class="tao-icon js-code-chance">'+e.chance+"</i>")):(yp.pub("page/task/extracnt",{cnt:0,type:"code"}),e._ui.$btn.find(".js-code-chance").remove(),t&&1==a&&e._ui.$btn.append('<i class="tao-icon js-code-chance">淘</i>')),e._ui.$btn.closest(".task-item").toggleClass("active",0==e.chance&&!t).find(".task-btn").toggleClass("task-click",0<e.chance||!!t)):(yp.pub("page/task/extracnt",{cnt:0,type:"code"}),e._ui.$btn.closest(".task-item").addClass("active").find(".task-btn").removeClass("task-click"),e._ui.$btn.find(".js-code-chance").remove())},fShowPanel:function(){var e=this;e.fShowCodeChoose()},fHidePanel:function(){var e=this;e.$panel.find(".js-code-load").hide(),e.$panel.find(".js-code-get").show(),e.$panel.find(".js-code-for-copy").hide(),e._ui.$choose_panel.hide(),e.$panel.hide()},fShowCodeChoose:function(){var e=this;if(!e.oCodeInfoArr.code.length&&!e.oCodeInfoArr.tao.length)return!1;if(yp.each(e._ui.$choose_panel.find(".js-code-choose-list"),function(a){e.fShowCodeList2($(a))}),e.oCodeInfoArr.tao.length){var a=new Date;a.setTime(a.getTime()+31536e6),$.cookie("thv_cookie",0,{expires:a,path:"/"}),e.fSetChance()}e._ui.$choose_panel.find(".js-show-tao-hao-area").toggle(!!e.oCodeInfoArr.tao.length&&!!e.chance),e._ui.$choose_panel.find('.js-code-choose-list[data-type="tao"]').toggle(!e.chance),e._ui.$choose_panel.find('.js-code-choose-list[data-type="code"]').toggle(!!e.chance),e._ui.$choose_panel.find(".js-choose-panel-title").html(e.chance?"激活码":"淘号"),e._ui.$choose_panel.show()},fLoadCodeInfo:function(e){var a=this,t=e.data("id"),o=e.data("type"),n=a.oCodeInfoArrHash[o][t],i=1==n.download.downloadType?n.download.downloadUrl:"",s="",s="";2==n.download.downloadType&&(n.download.downloadCode&&n.download.downloadCode.codeOs&&(s+='<div class="img-box di">                        <img src="'+n.download.downloadCode.downloadCode+'" alt="">                        <p class="name">'+n.download.downloadCode.codeOs+"</p>                      </div>"),n.download.downloadCode2&&n.download.downloadCode2.codeOs&&(s+='<div class="img-box di">                        <img src="'+n.download.downloadCode2.downloadCode+'" alt="">                        <p class="name">'+n.download.downloadCode2.codeOs+"</p>                      </div>"));var c=n.remark;c=c.replace(/\n/g,"<br>"),a.$panel.find(".js-tao-code-got").hide(),a.$panel.find(".js-activation-code-img").attr("src",n.pic),a.$panel.find(".js-activation-code-title").html(n.title),a.$panel.find(".js-activation-code-url").html(n.activateUrl),a.$panel.find(".js-activation-code-url-input").val(n.activateUrl),a.$panel.find(".js-activation-code-download").html(i),a.$panel.find(".js-activation-code-download-input").val(i),a.$panel.find(".js-activation-code-qrcode").html(s),a.$panel.find(".js-activation-code-desc").html(c),a.$panel.find(".ibox-bd").toggleClass("two-code",!!s),a.$panel.find(".js-code-id").val(n.id),a.$panel.find(".js-code-type").val(o),a.$panel.find(".js-code-panel-title").html("code"==o?"邀请码":"淘码"),a.$panel.find(".js-code-placeholder").html("code"==o?"点击“领取”显示激活码":"点击“淘号”显示激活码"),a.$panel.find(".js-show-code").html("code"==o?"领取":"淘号"),a.$panel.show();var l={position:"absolute",marginTop:0,top:$(window).scrollTop()+80};a.$panel.css(l)},fLoadCodeNum:function(e){var a=this,t=a.$panel.find(".js-code-type").val();return oPageConfig.oLoginInfo&&!oPageConfig.oLoginInfo.bindMobile?(yp.errorNotify("绑定手机号后才可以领取"),!1):void("code"==t?a.fDoLoadCodeNum(e):yp.use("geetest",function(t,o){
o.init(),t.pub("page/geetest/show",{self:a,fun:function(t){a.fDoLoadCodeNum(e,t)}})}))},fDoLoadCodeNum:function(e,a){var t=this,o=t.$panel.find(".js-code-type").val(),n=t.$panel.find(".js-code-id").val();if(e.data("ajaxing"))return!1;var i=a||{};i.id=n,t.$panel.find(".js-code-loading").show(),e.data("ajaxing",!0);var s="code"==o?"/api/actives/task/info.codeget":"/api/actives/task/info.taocodeget";yp.ajax(s,{type:"post",data:i,dataType:"json"}).always(function(){e.data("ajaxing",!1)}).done(function(e){if(t.$panel.find(".js-code-loading").hide(),0==e.code){"code"==o?(t.chance--,t.fSetChance(),t.oCodeInfoArrHash.code[n].got=1):t.$panel.find(".js-tao-code-got").show().find(".js-tao-code-got-num").html(e.data.getTimes),t.$panel.find(".js-code-get").hide(),t.$panel.find('.js-code-for-copy[data-type="'+o+'"]').show();var a=e.data.code?e.data.code:e.data;t.$panel.find(".js-code-for-copy .js-activation-code-show").html(a),t.$panel.find(".js-code-for-copy .js-activation-code-show-input").val(a)}else yp.ajaxNotice(e)})},fShowCodeList:function(e,a){var t=this,o=a.data("type"),n=t.oCodeInfoArr[o];a.data("pagination").options.curPage=e;var i=a.data("pagination").fGetListRange(),s=n.slice(i.nForm-1,i.nTo),c="";yp.each(s,function(e,a){e.got||(c+='<li>                      <a href="javascript:;" class="js-code-choose-item" data-id="'+e.id+'" data-type="'+o+'">                        <div class="img-box">                          <img src="'+e.pic+'" alt="">                          <p class="name">'+e.title+"</p>                        </div>                      </a>                    </li>")}),t._ui.$choose_panel.find('.js-code-choose-list[data-type="'+o+'"]').html(c)},fShowCodeList2:function(e){var a=this,t=e.data("type"),o=a.oCodeInfoArr[t],n="";yp.each(o,function(e,a){e.got||(n+='<li>                      <a href="javascript:;" class="js-code-choose-item" data-id="'+e.id+'" data-type="'+t+'">                        <div class="img-box">                          <img src="'+e.pic+'" alt="">                          <p class="name">'+e.title+"</p>                        </div>                      </a>                    </li>")}),e.html(n)},fShowPageHtml:function(e){var a=this,t=e.data("type"),o=a.oCodeInfoArr[t],n=e.data("pagination").options;n.count=o.length,n.curPage=1,n.totalPage=Math.ceil(n.count/n.prePage),e.html(e.data("pagination").fGetPagination())}};"undefined"!=typeof module?module.exports=e:"function"==typeof define&&define.amd?define(function(){return e}):window.oTask=e}();