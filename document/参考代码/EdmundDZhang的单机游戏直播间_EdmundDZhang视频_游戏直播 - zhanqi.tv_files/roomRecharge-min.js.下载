+function(){var a={_ui:{},oRechargeData:{},init:function(){this.view(),this.bindEvent(),this.listenYpEvent(),this.listenSocketEvent()},view:function(){$("body").append('<div class="common-ibox recharge-hbao-ibox" id="js-alipay-qrcode-pay-panel" style="display:none;">                    <div class="content">                      <div class="hd">                        <a href="javascript:;" class="close js-close"></a>                        <ul class="clearfix">                          <li class="js-qrcode-change" data-type="weixin"><a href="javascript:;">微信扫码</a></li>                          <li class="js-qrcode-change" data-type="alipay"><a href="javascript:;">支付宝扫码</a></li>                        </ul>                      </div>                      <div class="bd">                        <p class="title">                          金币不足，扫码快速补充<span class="num js-gold"></span>金币！                        </p>                        <div class="tabc active">                          <div class="img-box">                            <img class="js-qrcode-img" src="" alt="" style="display:none;">                            <i class="loading js-qrcode-loading"></i>                          </div>                          <p class="tit">扫码后请稍等，不要进行其他操作</p>                        </div>                      </div>                    </div>                  </div>'),this._ui.$alipay_qrcode_pay_panel=$("#js-alipay-qrcode-pay-panel")},bindEvent:function(){var a=this,e=a._ui;e.$alipay_qrcode_pay_panel.on("click",".js-qrcode-change",function(i){var o=$(this),p=o.data("type");return e.$alipay_qrcode_pay_panel.data("ajaxing")||a.fGetQrcode(p),!1}),e.$alipay_qrcode_pay_panel.on("click",".js-close",function(a){a.preventDefault(),yp.pub("page/alipay/qrcode/pay",{show:0})})},listenYpEvent:function(){var a=this,e=a._ui;yp.sub("page/alipay/qrcode/pay",function(i,o){o.show?(e.$alipay_qrcode_pay_panel.show().data("source",o.source||"gift").data("oCss",o.oCss),e.$alipay_qrcode_pay_panel.data("gold",o.gold),e.$alipay_qrcode_pay_panel.data("payFrom",o.payFrom||""),a.fGetQrcode(o.type||"alipay")):(e.$alipay_qrcode_pay_panel.data("weixin","").data("alipay","").hide(),a.fWSUnRegist("qrcode"))});var i;yp.sub("page/alipay/qrcode/complete",function(a,o){o.show?("gift"==e.$alipay_qrcode_pay_panel.data("source")&&(i=$.ibox({title:"充值提醒",content:"充值"+o.gold+"金币成功，是否立即赠送？",btns:[{name:"取消"},{name:"赠送",callback:function(){yp.pub("page/gift/buy")}}]}),i.dom.on("dom.destroy",function(){i=null})),yp.pub("page/rich/update",{num:o.gold,type:"gold"}),yp.pub("page/rich/update",{num:o.coin,type:"coin"})):i&&i.close()})},listenSocketEvent:function(){var a=this,e=a._ui;yp.sub("ws/Charge.Done",function(a,i){yp.pub("page/alipay/qrcode/complete",{show:1,gold:i.gold,coin:i.coin,source:e.$alipay_qrcode_pay_panel.data("source")}),yp.pub("page/alipay/qrcode/pay",{show:0})}),yp.sub("ws/error",function(){yp.config.debug&&alert("服务器连接失败，请稍后再试[ws]")}),$.topic("msgc/Rich.Inc").sub(function(a){yp.pub("page/rich/update",{num:a.gold,type:"gold"}),yp.pub("page/rich/update",{num:a.coin,type:"coin"})})},fGetQrcode:function(a){var e=this,i=e._ui;i.$alipay_qrcode_pay_panel.find(".js-qrcode-change").removeClass("active"),i.$alipay_qrcode_pay_panel.find('.js-qrcode-change[data-type="'+a+'"]').addClass("active"),"alipay"==a?e.fGetAlipayQrcode(i.$alipay_qrcode_pay_panel.data("gold"),oPageConfig.oRoom.id,i.$alipay_qrcode_pay_panel.data("payFrom")):e.fGetWeixinQrcode(i.$alipay_qrcode_pay_panel.data("gold"),oPageConfig.oRoom.id,i.$alipay_qrcode_pay_panel.data("payFrom"))},fGetAlipayQrcode:function(a,e,i){var o=this,p=o._ui;return p.$alipay_qrcode_pay_panel.data("ajaxing")?!1:p.$alipay_qrcode_pay_panel.data("alipay")?(p.$alipay_qrcode_pay_panel.find(".js-qrcode-img").show().attr("src",p.$alipay_qrcode_pay_panel.data("alipay")),!1):(p.$alipay_qrcode_pay_panel.find(".js-gold").html(a),p.$alipay_qrcode_pay_panel.find(".js-qrcode-loading").show(),p.$alipay_qrcode_pay_panel.find(".js-qrcode-img").hide(),p.$alipay_qrcode_pay_panel.data("ajaxing",!0),void o.oRechargeData.fGetAlipayQrcode(a,e,i).done(function(a){0==a.code?(p.$alipay_qrcode_pay_panel.find(".js-qrcode-loading").hide(),p.$alipay_qrcode_pay_panel.find(".js-qrcode-img").show().attr("src",a.data.url),p.$alipay_qrcode_pay_panel.data("alipay",a.data.url),o.fWSRegist("qrcode")):a.message&&yp.errorNotify(a.message)}).always(function(){p.$alipay_qrcode_pay_panel.data("ajaxing",!1)}))},fGetWeixinQrcode:function(a,e,i){var o=this,p=o._ui;return p.$alipay_qrcode_pay_panel.data("ajaxing")?!1:p.$alipay_qrcode_pay_panel.data("weixin")?(p.$alipay_qrcode_pay_panel.find(".js-qrcode-img").show().attr("src",p.$alipay_qrcode_pay_panel.data("weixin")),!1):(p.$alipay_qrcode_pay_panel.find(".js-gold").html(a),p.$alipay_qrcode_pay_panel.find(".js-qrcode-loading").show(),p.$alipay_qrcode_pay_panel.find(".js-qrcode-img").hide(),p.$alipay_qrcode_pay_panel.data("ajaxing",!0),void o.oRechargeData.fGetWeixinQrcode(a,e,i).done(function(a){0==a.code?(p.$alipay_qrcode_pay_panel.find(".js-qrcode-loading").hide(),p.$alipay_qrcode_pay_panel.find(".js-qrcode-img").show().attr("src",a.data.url),p.$alipay_qrcode_pay_panel.data("weixin",a.data.url),o.fWSRegist("qrcode")):a.message&&yp.errorNotify(a.message)}).always(function(){p.$alipay_qrcode_pay_panel.data("ajaxing",!1)}))},fWSRegist:function(a,e){oWS.regist(a,e)},fWSUnRegist:function(a){oWS.unregist(a)}};"undefined"!=typeof module?module.exports=a:"function"==typeof define&&define.amd?define(function(){return a}):window.oRoomRecharge=a}();