+function(){var e={_ui:{},oGeetestMobile:null,oGeetestNormal:null,bRefleshMobile:!0,bRefleshNormal:!0,oDtd:{accountDtd:null,emailDtd:null,nicknameDtd:null},init:function(e){var t=this;t.view(e),t.bindEvent(),t.listenYpPub()},view:function(e){var t=this;t._ui.$registModal=e,t._ui.$inputs=t._ui.$registModal.find(".inputs"),t._ui.$input_labels=t._ui.$registModal.find(".input-labels"),t._ui.$checkboxs=t._ui.$registModal.find(".js-checkbox"),t._ui.$registForm=t._ui.$registModal.find(".js-normal-form"),t._ui.$phoneRegistForm=t._ui.$registModal.find(".js-phone-form"),t._ui.$country_select=t._ui.$phoneRegistForm.find(".js-select-panel"),t._ui.$country_code_show=t._ui.$phoneRegistForm.find(".js-regist-country-code-show"),t._ui.$regist_phone=t._ui.$phoneRegistForm.find(".js-regist-phone"),t._ui.$regist_phone_code_btn=t._ui.$phoneRegistForm.find(".js-regist-phone-code-btn")},bindEvent:function(){var e=this;e._ui.$registForm.on("submit",function(t){t.preventDefault(),e.fNormalFormSubmit()}),e._ui.$phoneRegistForm.on("submit",function(t){t.preventDefault(),e.fPhoneFormSubmit()}),e._ui.$checkboxs.on("click",function(e){e.preventDefault();var t=$(this),i=!t.hasClass("checkboxed");t.closest(".label-row").find(".js-checkbox-hidden").prop("checked",i),t.toggleClass("checkboxed",i)});var t={account:e.fAccountCheck,password:e.fPswCheck,email:e.fEmailCheck,nickname:e.fNicknameCheck,phone:e.fPhoneCheck,phonecode:e.fPhoneCodeCheck},i="input",o=window.ie678;o&&(i="propertychange"),e._ui.$inputs.on("change",function(){$(this).data("isok",!1);var i=$(this),o=t[i.data("type")].call(e,i);e.fDealCheckResult(i,o.message,o.isok)}).on("blur",function(){var e=$(this);""==e.val()&&e.closest(".js-input").find(".input-labels").fadeIn()}).on(i,function(){var t=$(this);""==t.val()?t.closest(".js-input").find(".input-labels").fadeIn():t.closest(".js-input").find(".input-labels").fadeOut(),e.fDealCheckResult(t,"",!0)}).on("focus",function(t){""==$(this).val()&&e.fDealCheckResult($(this),"",!0)}),e._ui.$input_labels.on("click",function(e){e.preventDefault();var t=$(this);t.closest(".js-input").find(".inputs").focus()}),e._ui.$registModal.on("click",".login-link",function(t){t.preventDefault(),e.dataStatistics?yp.pub("page/login",{dataStatistics:e.dataStatistics}):yp.pub("page/login")}),e.fSelectInit(e._ui.$country_select),e._ui.$country_select.on("selectChange",function(){var t=e._ui.$country_select.find(".js-select-input").val();e._ui.$country_code_show.html(t)}),e._ui.$regist_phone_code_btn.on("click",function(t){t.preventDefault(),e.fGetPhoneCode()}),e._ui.$regist_phone.on(i,function(){e._ui.$phoneRegistForm.find(".js-phone-form-other-info").toggle(""!=e._ui.$regist_phone.val())})},dataStatistics:null,listenYpPub:function(){var e=this;yp.sub("page/login",function(){e.hideModal()}),yp.sub("page/regist",function(t,i){i?e.dataStatistics=i.dataStatistics:e.dataStatistics=null,window.Geetest?e.oGeetest||yp.pub("page/geetest/loaded"):yp.pub("page/geetest/load"),e.showModal()}),yp.sub("page/geetest/loaded",function(t){return e.oGeetestNormal||e.oGeetestMobile||!e._ui.$registModal?!1:(e.oGeetestNormal=new window.Geetest({gt:"19565ca5c1c44cd27dd44930982ffccd",product:"float"}),e.oGeetestNormal.appendTo(e._ui.$registModal.find(".js-geetest-normal-script")),e.oGeetestNormal.onRefresh(function(){e.bRefleshNormal=!0}),e.oGeetestNormal.onSuccess(function(){e.bRefleshNormal=!1}),e.oGeetestMobile=new window.Geetest({gt:"19565ca5c1c44cd27dd44930982ffccd",product:"float"}),e.oGeetestMobile.appendTo(e._ui.$registModal.find(".js-geetest-mobile-script")),e.oGeetestMobile.onRefresh(function(){e.bRefleshMobile=!0}),void e.oGeetestMobile.onSuccess(function(){e.bRefleshMobile=!1}))})},showModal:function(){var e=this;e._ui.$registForm[0].reset(),e._ui.$phoneRegistForm[0].reset(),e._ui.$phoneRegistForm.find(".js-phone-form-other-info").toggle(""!=e._ui.$regist_phone.val()),yp.each(e._ui.$inputs,function(t){e.fDealCheckResult($(t),"",!0),$(t).closest(".js-input").find(".input-labels").show()}),e._ui.$country_select.trigger("selectReset"),e.fCodeTimeReset(e._ui.$regist_phone_code_btn,"获取验证码"),$.fn.tabs&&e._ui.$registModal.find(".tabs").tabs("active",0),e._ui.$checkboxs.removeClass("checkboxed"),e.oGeetestNormal&&!e.bRefleshNormal&&e.oGeetestNormal.refresh(),e.oGeetestMobile&&!e.bRefleshMobile&&e.oGeetestMobile.refresh()},hideModal:function(){var e=this;return e._ui.$registModal?(e._ui.$registForm.find(".js-input-extra-action").remove(),e._ui.$phoneRegistForm.find(".js-input-extra-action").remove(),void(e.dataStatistics=null)):!1},fNormalFormSubmit:function(){var e=this;if(e._ui.$registForm.data("ajaxing"))return!1;var t={account:e.fAccountCheck,password:e.fPswCheck,nickname:e.fNicknameCheck},i=!0;return e._ui.$registForm.find(".inputs").each(function(){$(this).data("isok",!1);var o=$(this),n=t[o.data("type")].call(e,o);e.fDealCheckResult(o,n.message,n.isok),n.isok||(i=!1)}),i?e._ui.$registForm.find(".terms-service-input").prop("checked")?void $.when(e.oDtd.accountDtd,e.oDtd.nicknameDtd).done(function(){return e._ui.$registForm.find(".inputs").each(function(){$(this).data("isok")||(i=!1)}),e._ui.$registForm.data("ajaxing")||!i?!1:($.cookie("bf_ref_url")&&e._ui.$registForm.append('<input class="js-input-extra-action" type="hidden" name="bf_ref_url" value="'+$.cookie("bf_ref_url")+'" />'),void e._ui.$registForm.data("ajaxing",!0).ajaxSubmit().ajax.done(function(t){0==t.code?(oPageConfig.oLoginInfo=t.data,yp.pub("page/regist/done",t.data),e.dataStatistics&&_hmt&&_hmt.push(e.dataStatistics)):t.message&&yp.errorNotify(t.message),t.code&&setTimeout(function(){e.oGeetestNormal&&e.oGeetestNormal.refresh()},0)}).always(function(){e._ui.$registForm.data("ajaxing",!1)}).fail(function(e,t,i){"timeout"==t&&alert("注册超时，请稍后再试")}))}).always(function(){"rejected"==e.oDtd.accountDtd.state()&&(e.oDtd.accountDtd=null),"rejected"==e.oDtd.nicknameDtd.state()&&(e.oDtd.nicknameDtd=null)}):(yp.errorNotify("客官，您还未同意服务条款"),!1):!1},fPhoneFormSubmit:function(){var e=this;if(e._ui.$phoneRegistForm.data("ajaxing"))return!1;var t={password:e.fPswCheck,nickname:e.fNicknameCheck,phone:e.fPhoneCheck,phonecode:e.fPhoneCodeCheck},i=!0;return e._ui.$phoneRegistForm.find(".inputs").each(function(){$(this).data("isok",!1);var o=$(this),n=t[o.data("type")].call(e,o);e.fDealCheckResult(o,n.message,n.isok),n.isok||(i=!1)}),i?e._ui.$phoneRegistForm.find(".terms-service-input").prop("checked")?void $.when(e.oDtd.nicknameDtd).done(function(){return e._ui.$phoneRegistForm.find(".inputs").each(function(){$(this).data("isok")||(i=!1)}),e._ui.$phoneRegistForm.data("ajaxing")||!i?!1:($.cookie("bf_ref_url")&&e._ui.$phoneRegistForm.append('<input class="js-input-extra-action" type="hidden" name="bf_ref_url" value="'+$.cookie("bf_ref_url")+'" />'),void e._ui.$phoneRegistForm.data("ajaxing",!0).ajaxSubmit().ajax.done(function(t){0==t.code?(e.hideModal(),oPageConfig.oLoginInfo=t.data,yp.pub("page/regist/done",t.data),e.dataStatistics&&_hmt&&_hmt.push(e.dataStatistics)):t.message&&yp.errorNotify(t.message),t.code&&setTimeout(function(){e.oGeetestMobile&&e.oGeetestMobile.refresh()},0)}).always(function(){e._ui.$phoneRegistForm.data("ajaxing",!1)}).fail(function(e,t,i){"timeout"==t&&alert("注册超时，请稍后再试")}))}).always(function(){"rejected"==e.oDtd.nicknameDtd.state()&&(e.oDtd.nicknameDtd=null)}):(yp.errorNotify("客官，您还未同意服务条款"),!1):!1},fDealCheckResult:function(e,t,i){var o=this;if(e.data("isok",i),i)e.closest(".js-input").removeClass("error"),e.data("errorid")&&(o._ui.$registModal.find("#error-"+e.data("errorid")).remove(),e.data("errorid",0));else{e.closest(".js-input").addClass("error");var n=$.now(),s='<div class="title-area" id="error-'+n+'"><i class="icon dv"></i><span class="dv">'+t+"</span></div>";e.data("errorid")&&o._ui.$registModal.find("#error-"+e.data("errorid")).remove(),e.data("errorid",n).closest(".js-input").append(s)}},fGeetestError:function(e){var t=ui.$registModal.find(".js-geetest-script");t.hasClass("error")&&self.fGeetestSuccess(),t.addClass("error");var i=$.now(),o='<div class="title-area" id="error-'+i+'"><i class="icon dv"></i><span class="dv">'+e+"</span></div>";t.data("errorid",i).closest(".js-input").append(o)},fGeetestSuccess:function(){var e=ui.$registModal.find(".js-geetest-script");e.removeClass("error"),e.data("errorid")&&(self._ui.$registModal.find("#error-"+e.data("errorid")).remove(),e.data("errorid",0))},fAccountCheck:function(e){var t=this,i=/^[A-Za-z0-9_]{5,16}$/,o=e.val(),n={isok:!1,message:""};return t.oDtd.accountDtd=$.Deferred(),""==o?(n.message="看官老爷，请填写账号。",t.oDtd.accountDtd.reject()):i.test(o)?(n.isok=!0,yp.ajax(yp.format(oPageConfig.oUrl.sUrlValidate,{type:"account"}),{data:{account:o},type:"post",dataType:"json"}).done(function(i){0==i.code?(t.oDtd.accountDtd.resolve(),t.fDealCheckResult(e,"",!0)):(t.oDtd.accountDtd.reject(),t.fDealCheckResult(e,i.message,!1))}).fail(function(){t.fDealCheckResult(e,"",!0),t.oDtd.accountDtd.resolve()})):(n.message="账号需字母开头，5-16位非纯数字字符。",t.oDtd.accountDtd.reject()),n},fNicknameCheck:function(t){var i=this,o=t.val(),n=0,s={isok:!1,message:""};return n=e.fGetStrLen(o),i.oDtd.nicknameDtd=$.Deferred(),""==o?(s.message="看官老爷，请填写昵称。",i.oDtd.nicknameDtd.reject()):6>n||n>24?(s.message="昵称需6-24位中英文字符。",i.oDtd.nicknameDtd.reject()):(s.isok=!0,yp.ajax(yp.format(oPageConfig.oUrl.sUrlValidate,{type:"nickname"}),{data:{nickname:o},type:"post",dataType:"json"}).done(function(e){0==e.code?(i.oDtd.nicknameDtd.resolve(),i.fDealCheckResult(t,"",!0)):(i.oDtd.nicknameDtd.reject(),i.fDealCheckResult(t,e.message,!1))}).fail(function(){i.fDealCheckResult(t,"",!0),i.oDtd.nicknameDtd.resolve()})),s},fPswCheck:function(e){var t=this,i=/^.{6,30}$/,o=e.val(),n={isok:!1,message:""},s=e.data("confirm")?!0:!1;return s?o!=$("#password-input").val()?n.message="看官老爷，2次密码需要一致":n.isok=!0:""==o?n.message="看官老爷，请填写密码。":i.test(o)?(n.isok=!0,e.closest(".js-normal-form").length&&($("#password-input-confirm").val()&&o!=$("#password-input-confirm").val()?t.fDealCheckResult($("#password-input-confirm"),"看官老爷，2次密码需要一致",!1):t.fDealCheckResult($("#password-input-confirm"),"",!0))):n.message="密码需6-30位字符",n},fEmailCheck:function(e){return{isok:!0,message:""}},fPhoneCheck:function(e){var t=e.val(),i={isok:!1,message:""};return""==t?i.message="看官老爷，请留下您的账号哦！":i.isok=!0,i},fPhoneCodeCheck:function(e){var t=e.val(),i={isok:!1,message:""};return""==t?i.message="看官老爷，请填写手机验证码！":i.isok=!0,i},fGetPhoneCode:function(){var e=this,t=e._ui;return""==t.$regist_phone.val()?(e.fDealCheckResult(t.$regist_phone,"请填写手机号",!1),!1):t.$regist_phone_code_btn.data("timing")?!1:(t.$regist_phone_code_btn.data("timing",!0),e.fCodeTimeCutdown(t.$regist_phone_code_btn,60),void yp.ajax(oPageConfig.oUrl.sRegistPhoneCode,{type:"post",dataType:"json",data:{mobile:t.$regist_phone.val(),countryCode:t.$country_select.find(".js-select-input").val(),geetest_challenge:t.$phoneRegistForm.find('.js-geetest-mobile-script [name="geetest_challenge"]').val(),geetest_validate:t.$phoneRegistForm.find('.js-geetest-mobile-script [name="geetest_validate"]').val(),geetest_seccode:t.$phoneRegistForm.find('.js-geetest-mobile-script [name="geetest_seccode"]').val()}}).done(function(i){0==i.code?e.fDealCheckResult(t.$regist_phone,"",!0):(10001==i.code?e.fDealCheckResult(e._ui.$phoneRegistForm.find('[name="mobile"]'),'该手机已注册或已绑定，<br />您可以使用该手机号码<a href="javascript:;" class="login-link">直接登录</a>',!1):e.fDealCheckResult(e._ui.$phoneRegistForm.find('[name="mobile"]'),i.message,!1),e.fCodeTimeReset(t.$regist_phone_code_btn,"重新获取"))}).fail(function(){e.fCodeTimeReset(t.$regist_phone_code_btn,"重新获取")}))},fCodeTimeCutdown:function(e,t){var i=this,o=0;e.data("timeout")&&clearTimeout(e.data("timeout")),t?(e.html("发送中("+t+")"),o=setTimeout(function(){t--,i.fCodeTimeCutdown(e,t)},1e3),e.data("timeout",o)):i.fCodeTimeReset(e,"重新获取")},fCodeTimeReset:function(e,t){var i=this,o=i._ui;o.$regist_phone_code_btn.data("timing",!1),e.data("timeout")&&clearTimeout(e.data("timeout")),e.html(t)},fGetStrLen:function(e){for(var t=0,i=e.split(""),o=0;o<i.length;o++)i[o].charCodeAt(0)<299?t++:t+=3;return t},fSelectInit:function(e){e.on("click",function(t){t.preventDefault();var i=$(this).closest(".js-select-panel").find(".js-select-list");i.is(":visible")||(i.show(),e.css({zIndex:400}),setTimeout(function(){$("body").off("click.select").on("click.select",function(t){i.hide(),e.css({zIndex:""}),$("body").off("click.select")})},0))}),e.on("click",".js-select-item",function(e){e.preventDefault();var t=$(this),i=t.closest(".js-select-panel"),o=i.find(".js-select-txt"),n=i.find(".js-select-input");n.val()!=t.data("value")&&(n.val(t.data("value")),o.html(t.html()),o.html(t.data("value")),i.trigger("selectChange"))}),e.on("selectReset",function(){var e=$(this),t=e.find(".js-select-txt"),i=e.find(".js-select-input"),o=e.find(".js-select-item").eq(0);i.val()!=o.data("value")&&(i.val(o.data("value")),t.html(o.data("value")),e.trigger("selectChange"))})}};"undefined"!=typeof module?module.exports=e:"function"==typeof define&&define.amd?define(function(){return e}):window.oRegist=e}();