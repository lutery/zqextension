+function(t){"use strict";var e=function(e,i){this.$element=t(e),this.options=i,this.cnt=0,this.init()};e.DEFAULTS={type:""},e.prototype={init:function(){var t=this;return t.options.type?(this.view(),this.bindEvent(),this.listenYpEvent(),this.listenSocketEvent(),void yp.sub("page/room/login/done",function(){t.fSendStart()})):(yp.config.debug&&alert("未知type类型"),!1)},view:function(){},bindEvent:function(){var t=this;t.$element.on("click",function(e){e.preventDefault(),t.fUse()})},listenYpEvent:function(){var t=this;yp.sub("page/logout/done",function(){t.fClearTime(),t.fSetCnt(0)})},listenSocketEvent:function(){var e=this;t.topic("msgc/timegiftinfo").sub(function(t){e.fClearTime(),oPageConfig.oLoginInfo&&(e.fSetCnt(t.cnt),t.lefttime&&e.fCuttimeDown(t.lefttime)),e.options.fAfterInfo&&e.options.fAfterInfo(t)}),t.topic("msgc/timegiftupdate").sub(function(t){e.fSetCnt(t.cnt),e.fClearTime(),t.lefttime&&e.fCuttimeDown(t.lefttime)}),t.topic("msgc/timegiftuse").sub(function(t){e.fSetCnt(t.cnt),0==t.code?(e.fClearTime(),t.lefttime&&e.fCuttimeDown(t.lefttime)):t.message&&yp.errorNotify(t.message)}),t.topic("msgc/timegiftbro").sub(function(t){e.options.fAfterBro&&e.options.fAfterBro(t)})},fSendStart:function(){var t=this;t.ajax_socket("timegiftinfo",{type:t.options.type})},timeout:0,fCuttimeDown:function(t){var e=this;if(t>0){var i,n,o=60;i=Math.floor(t/o),n=t%o,i=e.fFillZero(i,2),n=e.fFillZero(n,2),e.$element.find(".js-time-cutdown-area").show().find(".js-time-cutdown").html(i+":"+n),e.timeout=setTimeout(function(){t--,e.fCuttimeDown(t)},1e3)}else e.fClearTime()},fFillZero:function(t,e){return t="00000"+t,t.slice(-e)},fClearTime:function(){var t=this;t.timeout&&clearTimeout(t.timeout),t.$element.find(".js-time-cutdown").html("00:00"),t.$element.find(".js-time-cutdown-area").hide()},fSetCnt:function(t,e){var i=this;switch(e=e||"update"){case"update":i.cnt=t;break;case"add":i.cnt+=+t;break;case"cut":i.cnt-=+t}i.$element.find(".js-cnt-tips").html(i.cnt).toggle(0<i.cnt),i.options.fCntChange&&i.options.fCntChange(i.cnt)},fUse:function(){var t=this;if(!oPageConfig.oLoginInfo)return yp.pub("page/login"),!1;if(!t.cnt)return!1;if(!oPageConfig.oLoginInfo.bindMobile)return yp.errorNotify("请先绑定手机"),!1;var e=t.options.perCnt||1;e>1?t.ajax_socket("timegiftuse",{type:t.options.type,cnt:+cnt}):t.ajax_socket("timegiftuse",{type:t.options.type}),t.fSetCnt(e,"cut")},ajax_socket:function(t,e){return e=e||{},yp.ajax(t,{type:"socket",data:e})}};var i=t.fn.timegift;t.fn.timegift=function(i){return this.each(function(){var n=t(this),o=n.data("timegift"),f=t.extend({},e.DEFAULTS,n.data(),"object"==typeof i&&i);o||n.data("timegift",o=new e(this,f))})},t.fn.timegift.Constructor=e,t.fn.timegift.noConflict=function(){return t.fn.timegift=i,this}}(window.jQuery);