+function(){var e={_ui:{},oPlaneTicketMsg:null,init:function(){var e=this;e.view(),e.bindEvent(),e.listenYpEvent(),e.listenSocketEvent(),e.fPlantTicketBtnStatus()},view:function(){var e=this,a='<div class="live-airfare-area" id="js-plane-ticket-btn-layer" style="display:none;"><a href="javascript:;" id="js-plane-ticket-btn" class="live-airfare"></a><a href="javascript:;" class="close js-close"></a></div>',n=e._ui;$("#js-chat-control-panel").find("#js-small-control-layer").length||$("#js-chat-control-panel").append('<div class="live-new-fun" id="js-small-control-layer"></div>'),$("#js-small-control-layer").prepend(a),n.$plane_ticket_btn=$("#js-plane-ticket-btn"),n.$plane_ticket_btn_layer=$("#js-plane-ticket-btn-layer")},bindEvent:function(){var e=this,a=e._ui;a.$plane_ticket_btn.on("click",function(a){a.preventDefault(),oPageConfig.aGameList?e.fShowMsgFillPanel():yp.ajax("/api/static/v2.1/game/lists/100/1.json",{data:"get",data:{_v:Math.floor($.now()/6e4)},dataType:"json"}).done(function(a){0==a.code&&(oPageConfig.aGameList=a.data.games,e.fShowMsgFillPanel())})}),a.$plane_ticket_btn_layer.on("mouseenter",function(){a.$plane_ticket_btn_layer.addClass("hover")}).on("mouseleave",function(){a.$plane_ticket_btn_layer.removeClass("hover")}).on("click",".js-close",function(){a.$plane_ticket_btn_layer.hide()})},listenYpEvent:function(){var e=this;e._ui;yp.sub("page/logout/done",function(){e.fRemoveMsgPanel()}),yp.sub("page/room/login/done",function(){e.fPlantTicketBtnStatus()})},listenSocketEvent:function(){$.topic("msgc/ticket").sub(function(e){if(25>e.data.level&&6>e.data.pos&&oPageConfig.oRoom.gameId!=e.data.gameId||oPageConfig.oLoginInfo&&e.data.uid==oPageConfig.oLoginInfo.uid||oPageConfig.oRoom.id==e.data.roomId)return!1;var a="",n=fLevelIconClass(e.data.level,e.data.pos,e.data.type);a='<a href="javascript:;" class="name">                  <i class="all-level '+n+' dv"></i>                  <span class="dv">'+e.data.nickname+'：</span>                </a>                <p>邀请您去“<span class="zbnc">'+e.data.anchor+'</span>”的直播间逛逛</p>                <p class="room-name clearfix"><a href="'+e.data.url+'" target="_blank">前往»</a>“'+filterXSS(e.data.content)+"”</p>",yp.pub("page/room/sysmsg",{content:a,liClass:"ticket"})})},fShowMsgFillPanel:function(){var e=this,a=(e._ui,""),n="";if(!oPageConfig.oLoginInfo)return yp.pub("page/login"),!1;if(23>oPageConfig.oLoginInfo.slevel.level&&6>oPageConfig.oLoginInfo.slevel.pos)return!1;var t="";25<=oPageConfig.oLoginInfo.slevel.level||6<=oPageConfig.oLoginInfo.slevel.pos?(a=3,n="全站广播",t='<input type="hidden" class="js-select-input" name="gameId" value="'+oPageConfig.oRoom.gameId+'">'):24==oPageConfig.oLoginInfo.slevel.level?(a=2,n="指定游戏分类广播",t='<div class="row clearfix">                            <div class="row-left">游戏分类：</div>                            <div class="row-right">                              <div class="js-plane-ticket-game-select"></div>                            </div>                          </div>'):(a=1,n="当前游戏分类广播",t='<input type="hidden" class="js-select-input" name="gameId" value="'+oPageConfig.oRoom.gameId+'">');var o='<p class="aircraft-title">填写飞机票,可邀请其他房间观众来当前直播间。</p>        <input type="hidden" name="roomId" value="'+oPageConfig.oRoom.id+'" />        <div class="aircraft-content">          <div class="row clearfix">            <div class="row-left">广播类型：</div>            <div class="row-right">'+n+"</div>          </div>"+t+'          <div class="row clearfix">            <div class="row-left">广播内容：</div>            <div class="row-right">              <textarea name="content"></textarea>            </div>          </div>        </div>';e.oPlaneTicketMsg=new popDialog({uniqueDialog:!0,title:"填写飞机票",dialogType:"planeTicket",formDialog:!0,formAction:"/api/actives/ticket/index.ticket",content:o,btns:[{type:"submit",text:"发送"}]}),2==a&&e.oPlaneTicketMsg.$dom.find(".js-plane-ticket-game-select").gameSelect({postName:"gameId",aGameList:oPageConfig.aGameList,selectedId:oPageConfig.oRoom.gameId,useZqSelect:!0});var i=e.oPlaneTicketMsg.$dom.find(".dialog-form");i.on("submit",function(a){if(a.preventDefault(),i.data("ajaxing"))return!1;var n=i.find('[name="content"]').val();return""==n?(yp.errorNotify("请填写广播内容"),!1):void i.data("ajaxing",!0).ajaxSubmit().ajax.done(function(a){0==a.code?(yp.successNotify("发送成功"),oPageConfig.oViewer.prop.ticket--,e.fPlantTicketBtnStatus(),e.fRemoveMsgPanel()):a.message&&yp.errorNotify(a.message)}).always(function(){i.data("ajaxing",!1)})})},fRemoveMsgPanel:function(){var e=this;e.oPlaneTicketMsg&&(e.oPlaneTicketMsg.close(e.oPlaneTicketMsg.$dom),e.oPlaneTicketMsg=null)},fPlantTicketBtnStatus:function(){var e=this,a=e._ui;oPageConfig.oLoginInfo&&(23<=oPageConfig.oLoginInfo.slevel.level||6<=oPageConfig.oLoginInfo.slevel.pos)&&0<oPageConfig.oViewer.prop.ticket?a.$plane_ticket_btn_layer.show():a.$plane_ticket_btn_layer.hide()}};"undefined"!=typeof module?module.exports=e:"function"==typeof define&&define.amd?define(function(){return e}):window.oPlaneTicket=e}();